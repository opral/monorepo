DetectChanges query plan playground

Generated at: 2025-11-08T22:56:54.368Z

# Query 1

Original SQL (same as executed):
select "entity_id", "schema_key", "snapshot_content" from "state" where "file_id" = ? and "inherited_from_version_id" is null and "schema_key" in (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)

Rewritten SQL:
SELECT
  "entity_id",
  "schema_key",
  "snapshot_content"
FROM (SELECT
  entity_id,
  schema_key,
  file_id,
  plugin_key,
  snapshot_content,
  schema_version,
  created_at,
  updated_at,
  inherited_from_version_id,
  change_id,
  untracked,
  commit_id,
  writer_key,
  metadata
FROM (SELECT
  entity_id,
  schema_key,
  file_id,
  version_id,
  plugin_key,
  snapshot_content,
  schema_version,
  created_at,
  updated_at,
  inherited_from_version_id,
  change_id,
  untracked,
  commit_id,
  writer_key,
  (SELECT json(metadata)
FROM (SELECT
  c.id,
  c.entity_id,
  c.schema_key,
  c.schema_version,
  c.file_id,
  c.plugin_key,
  json(c.metadata) AS metadata,
  c.created_at,
  json(s.content) AS snapshot_content
FROM lix_internal_change AS c LEFT JOIN lix_internal_snapshot AS s ON s.id = c.snapshot_id
UNION ALL
SELECT
  t.id,
  t.entity_id,
  t.schema_key,
  t.schema_version,
  t.file_id,
  t.plugin_key,
  json(t.metadata) AS metadata,
  t.created_at,
  json(t.snapshot_content) AS snapshot_content
FROM lix_internal_transaction_state AS t
WHERE t.untracked = 0) AS change
WHERE change.id = lix_internal_state_vtable.change_id) AS metadata
FROM (
SELECT
  w."entity_id" AS "entity_id",
  w."schema_key" AS "schema_key",
  w."file_id" AS "file_id",
  w."plugin_key" AS "plugin_key",
  w."snapshot_content" AS "snapshot_content",
  w."schema_version" AS "schema_version",
  w."version_id" AS "version_id",
  w."created_at" AS "created_at",
  w."updated_at" AS "updated_at",
  w."inherited_from_version_id" AS "inherited_from_version_id",
  w."change_id" AS "change_id",
  w."untracked" AS "untracked",
  w."commit_id" AS "commit_id",
  w."metadata" AS "metadata",
  COALESCE(ws_dst.writer_key, ws_src.writer_key, w.writer_key) AS "writer_key"
FROM (
  SELECT
    c.entity_id AS entity_id,
    c.schema_key AS schema_key,
    c.file_id AS file_id,
    c.plugin_key AS plugin_key,
    c.snapshot_content AS snapshot_content,
    c.schema_version AS schema_version,
    c.version_id AS version_id,
    c.created_at AS created_at,
    c.updated_at AS updated_at,
    c.inherited_from_version_id AS inherited_from_version_id,
    c.change_id AS change_id,
    c.untracked AS untracked,
    c.commit_id AS commit_id,
    c.metadata AS metadata,
    c.writer_key AS writer_key,
    c.priority AS priority,
    ROW_NUMBER() OVER (
            PARTITION BY c.file_id, c.schema_key, c.entity_id, c.version_id
            ORDER BY c.priority, c.created_at DESC, c.file_id, c.schema_key, c.entity_id, c.version_id, c.change_id
          ) AS rn
  FROM (
      SELECT
        unt.entity_id AS entity_id,
        unt.schema_key AS schema_key,
        unt.file_id AS file_id,
        unt.plugin_key AS plugin_key,
        json(unt.snapshot_content) AS snapshot_content,
        unt.schema_version AS schema_version,
        unt.version_id AS version_id,
        unt.created_at AS created_at,
        unt.updated_at AS updated_at,
        NULL AS inherited_from_version_id,
        'untracked' AS change_id,
        1 AS untracked,
        'untracked' AS commit_id,
        NULL AS metadata,
        NULL AS writer_key,
        2 AS priority
      FROM lix_internal_state_all_untracked unt
      WHERE (unt.schema_key IN ('markdown_wc_root', 'markdown_wc_paragraph', 'markdown_wc_heading', 'markdown_wc_list', 'markdown_wc_list_item', 'markdown_wc_blockquote', 'markdown_wc_code', 'markdown_wc_inline_code', 'markdown_wc_thematic_break', 'markdown_wc_break', 'markdown_wc_html', 'markdown_wc_image', 'markdown_wc_link', 'markdown_wc_emphasis', 'markdown_wc_strong', 'markdown_wc_delete', 'markdown_wc_table', 'markdown_wc_table_row', 'markdown_wc_table_cell', 'markdown_wc_text', 'markdown_wc_yaml', 'markdown_wc_document')) AND (unt.file_id IN ('playground-md'))

          UNION ALL

      		SELECT
          cache.entity_id AS entity_id,
          cache.schema_key AS schema_key,
          cache.file_id AS file_id,
          cache.plugin_key AS plugin_key,
          json(cache.snapshot_content) AS snapshot_content,
          cache.schema_version AS schema_version,
          cache.version_id AS version_id,
          cache.created_at AS created_at,
          cache.updated_at AS updated_at,
          cache.inherited_from_version_id AS inherited_from_version_id,
          cache.change_id AS change_id,
          0 AS untracked,
          cache.commit_id AS commit_id,
          NULL AS metadata,
          NULL AS writer_key,
          3 AS priority
      		FROM (SELECT
          "entity_id",
          "schema_key",
          "file_id",
          "plugin_key",
          "snapshot_content",
          "schema_version",
          "version_id",
          "created_at",
          "updated_at",
          "inherited_from_version_id",
          "change_id",
          "commit_id",
          "is_tombstone"
        FROM "lix_internal_state_cache_v1_markdown_wc_paragraph"
      UNION ALL
      SELECT
          "entity_id",
          "schema_key",
          "file_id",
          "plugin_key",
          "snapshot_content",
          "schema_version",
          "version_id",
          "created_at",
          "updated_at",
          "inherited_from_version_id",
          "change_id",
          "commit_id",
          "is_tombstone"
        FROM "lix_internal_state_cache_v1_markdown_wc_heading"
      UNION ALL
      SELECT
          "entity_id",
          "schema_key",
          "file_id",
          "plugin_key",
          "snapshot_content",
          "schema_version",
          "version_id",
          "created_at",
          "updated_at",
          "inherited_from_version_id",
          "change_id",
          "commit_id",
          "is_tombstone"
        FROM "lix_internal_state_cache_v1_markdown_wc_document") cache
      		WHERE (cache.schema_key IN ('markdown_wc_root', 'markdown_wc_paragraph', 'markdown_wc_heading', 'markdown_wc_list', 'markdown_wc_list_item', 'markdown_wc_blockquote', 'markdown_wc_code', 'markdown_wc_inline_code', 'markdown_wc_thematic_break', 'markdown_wc_break', 'markdown_wc_html', 'markdown_wc_image', 'markdown_wc_link', 'markdown_wc_emphasis', 'markdown_wc_strong', 'markdown_wc_delete', 'markdown_wc_table', 'markdown_wc_table_row', 'markdown_wc_table_cell', 'markdown_wc_text', 'markdown_wc_yaml', 'markdown_wc_document')) AND (cache.file_id IN ('playground-md'))
  ) AS c
) AS w

LEFT JOIN lix_internal_state_writer ws_dst ON
  ws_dst.file_id = w.file_id AND
  ws_dst.entity_id = w.entity_id AND
  ws_dst.schema_key = w.schema_key AND
  ws_dst.version_id = w.version_id
LEFT JOIN lix_internal_state_writer ws_src ON
  ws_src.file_id = w.file_id AND
  ws_src.entity_id = w.entity_id AND
  ws_src.schema_key = w.schema_key AND
  ws_src.version_id = w.inherited_from_version_id

LEFT JOIN lix_internal_change chc ON chc.id = w.change_id

WHERE w.rn = 1
) AS "lix_internal_state_vtable"
WHERE snapshot_content IS NOT NULL) AS state_by_version
WHERE version_id IN (SELECT version_id
FROM (SELECT
  json_extract(sa.snapshot_content, '$.id') AS id,
  json_extract(sa.snapshot_content, '$.version_id') AS version_id,
  sa.entity_id AS lixcol_entity_id,
  sa.schema_key AS lixcol_schema_key,
  sa.file_id AS lixcol_file_id,
  sa.plugin_key AS lixcol_plugin_key,
  COALESCE(sa.inherited_from_version_id, 'global') AS lixcol_inherited_from_version_id,
  sa.created_at AS lixcol_created_at,
  sa.updated_at AS lixcol_updated_at,
  sa.change_id AS lixcol_change_id,
  sa.untracked AS lixcol_untracked,
  sa.commit_id AS lixcol_commit_id,
  sa.metadata AS lixcol_metadata
FROM (SELECT
  entity_id,
  schema_key,
  file_id,
  version_id,
  plugin_key,
  snapshot_content,
  schema_version,
  created_at,
  updated_at,
  inherited_from_version_id,
  change_id,
  untracked,
  commit_id,
  writer_key,
  (SELECT json(metadata)
FROM (SELECT
  c.id,
  c.entity_id,
  c.schema_key,
  c.schema_version,
  c.file_id,
  c.plugin_key,
  json(c.metadata) AS metadata,
  c.created_at,
  json(s.content) AS snapshot_content
FROM lix_internal_change AS c LEFT JOIN lix_internal_snapshot AS s ON s.id = c.snapshot_id
UNION ALL
SELECT
  t.id,
  t.entity_id,
  t.schema_key,
  t.schema_version,
  t.file_id,
  t.plugin_key,
  json(t.metadata) AS metadata,
  t.created_at,
  json(t.snapshot_content) AS snapshot_content
FROM lix_internal_transaction_state AS t
WHERE t.untracked = 0) AS change
WHERE change.id = lix_internal_state_vtable.change_id) AS metadata
FROM (
SELECT
  w."entity_id" AS "entity_id",
  w."schema_key" AS "schema_key",
  w."file_id" AS "file_id",
  w."plugin_key" AS "plugin_key",
  w."snapshot_content" AS "snapshot_content",
  w."schema_version" AS "schema_version",
  w."version_id" AS "version_id",
  w."created_at" AS "created_at",
  w."updated_at" AS "updated_at",
  w."inherited_from_version_id" AS "inherited_from_version_id",
  w."change_id" AS "change_id",
  w."untracked" AS "untracked",
  w."commit_id" AS "commit_id",
  w."metadata" AS "metadata",
  COALESCE(ws_dst.writer_key, ws_src.writer_key, w.writer_key) AS "writer_key"
FROM (
  SELECT
    c.entity_id AS entity_id,
    c.schema_key AS schema_key,
    c.file_id AS file_id,
    c.plugin_key AS plugin_key,
    c.snapshot_content AS snapshot_content,
    c.schema_version AS schema_version,
    c.version_id AS version_id,
    c.created_at AS created_at,
    c.updated_at AS updated_at,
    c.inherited_from_version_id AS inherited_from_version_id,
    c.change_id AS change_id,
    c.untracked AS untracked,
    c.commit_id AS commit_id,
    c.metadata AS metadata,
    c.writer_key AS writer_key,
    c.priority AS priority,
    ROW_NUMBER() OVER (
            PARTITION BY c.file_id, c.schema_key, c.entity_id, c.version_id
            ORDER BY c.priority, c.created_at DESC, c.file_id, c.schema_key, c.entity_id, c.version_id, c.change_id
          ) AS rn
  FROM (
      SELECT
        unt.entity_id AS entity_id,
        unt.schema_key AS schema_key,
        unt.file_id AS file_id,
        unt.plugin_key AS plugin_key,
        json(unt.snapshot_content) AS snapshot_content,
        unt.schema_version AS schema_version,
        unt.version_id AS version_id,
        unt.created_at AS created_at,
        unt.updated_at AS updated_at,
        NULL AS inherited_from_version_id,
        'untracked' AS change_id,
        1 AS untracked,
        'untracked' AS commit_id,
        NULL AS metadata,
        NULL AS writer_key,
        2 AS priority
      FROM lix_internal_state_all_untracked unt
      WHERE (unt.schema_key IN ('markdown_wc_root', 'markdown_wc_paragraph', 'markdown_wc_heading', 'markdown_wc_list', 'markdown_wc_list_item', 'markdown_wc_blockquote', 'markdown_wc_code', 'markdown_wc_inline_code', 'markdown_wc_thematic_break', 'markdown_wc_break', 'markdown_wc_html', 'markdown_wc_image', 'markdown_wc_link', 'markdown_wc_emphasis', 'markdown_wc_strong', 'markdown_wc_delete', 'markdown_wc_table', 'markdown_wc_table_row', 'markdown_wc_table_cell', 'markdown_wc_text', 'markdown_wc_yaml', 'markdown_wc_document', 'lix_active_version')) AND (unt.version_id IN ('global'))

          UNION ALL

      		SELECT
          cache.entity_id AS entity_id,
          cache.schema_key AS schema_key,
          cache.file_id AS file_id,
          cache.plugin_key AS plugin_key,
          json(cache.snapshot_content) AS snapshot_content,
          cache.schema_version AS schema_version,
          cache.version_id AS version_id,
          cache.created_at AS created_at,
          cache.updated_at AS updated_at,
          cache.inherited_from_version_id AS inherited_from_version_id,
          cache.change_id AS change_id,
          0 AS untracked,
          cache.commit_id AS commit_id,
          NULL AS metadata,
          NULL AS writer_key,
          3 AS priority
      		FROM (SELECT
          "entity_id",
          "schema_key",
          "file_id",
          "plugin_key",
          "snapshot_content",
          "schema_version",
          "version_id",
          "created_at",
          "updated_at",
          "inherited_from_version_id",
          "change_id",
          "commit_id",
          "is_tombstone"
        FROM "lix_internal_state_cache_v1_markdown_wc_paragraph"
      UNION ALL
      SELECT
          "entity_id",
          "schema_key",
          "file_id",
          "plugin_key",
          "snapshot_content",
          "schema_version",
          "version_id",
          "created_at",
          "updated_at",
          "inherited_from_version_id",
          "change_id",
          "commit_id",
          "is_tombstone"
        FROM "lix_internal_state_cache_v1_markdown_wc_heading"
      UNION ALL
      SELECT
          "entity_id",
          "schema_key",
          "file_id",
          "plugin_key",
          "snapshot_content",
          "schema_version",
          "version_id",
          "created_at",
          "updated_at",
          "inherited_from_version_id",
          "change_id",
          "commit_id",
          "is_tombstone"
        FROM "lix_internal_state_cache_v1_markdown_wc_document") cache
      		WHERE (cache.schema_key IN ('markdown_wc_root', 'markdown_wc_paragraph', 'markdown_wc_heading', 'markdown_wc_list', 'markdown_wc_list_item', 'markdown_wc_blockquote', 'markdown_wc_code', 'markdown_wc_inline_code', 'markdown_wc_thematic_break', 'markdown_wc_break', 'markdown_wc_html', 'markdown_wc_image', 'markdown_wc_link', 'markdown_wc_emphasis', 'markdown_wc_strong', 'markdown_wc_delete', 'markdown_wc_table', 'markdown_wc_table_row', 'markdown_wc_table_cell', 'markdown_wc_text', 'markdown_wc_yaml', 'markdown_wc_document', 'lix_active_version')) AND (cache.version_id IN ('global'))
  ) AS c
) AS w

LEFT JOIN lix_internal_state_writer ws_dst ON
  ws_dst.file_id = w.file_id AND
  ws_dst.entity_id = w.entity_id AND
  ws_dst.schema_key = w.schema_key AND
  ws_dst.version_id = w.version_id
LEFT JOIN lix_internal_state_writer ws_src ON
  ws_src.file_id = w.file_id AND
  ws_src.entity_id = w.entity_id AND
  ws_src.schema_key = w.schema_key AND
  ws_src.version_id = w.inherited_from_version_id

LEFT JOIN lix_internal_change chc ON chc.id = w.change_id

WHERE w.rn = 1
) AS "lix_internal_state_vtable"
WHERE snapshot_content IS NOT NULL) AS sa
WHERE sa.schema_key = 'lix_active_version' AND sa.version_id = 'global') AS active_version)) AS state
WHERE "file_id" = ? AND "inherited_from_version_id" IS NULL AND "schema_key" IN (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)

Executed SQL:
select "entity_id", "schema_key", "snapshot_content" from "state" where "file_id" = ? and "inherited_from_version_id" is null and "schema_key" in (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)

Parameters:
  $1: "playground-md"
  $2: "markdown_wc_root"
  $3: "markdown_wc_paragraph"
  $4: "markdown_wc_heading"
  $5: "markdown_wc_list"
  $6: "markdown_wc_list_item"
  $7: "markdown_wc_blockquote"
  $8: "markdown_wc_code"
  $9: "markdown_wc_inline_code"
  $10: "markdown_wc_thematic_break"
  $11: "markdown_wc_break"
  $12: "markdown_wc_html"
  $13: "markdown_wc_image"
  $14: "markdown_wc_link"
  $15: "markdown_wc_emphasis"
  $16: "markdown_wc_strong"
  $17: "markdown_wc_delete"
  $18: "markdown_wc_table"
  $19: "markdown_wc_table_row"
  $20: "markdown_wc_table_cell"
  $21: "markdown_wc_text"
  $22: "markdown_wc_yaml"
  $23: "markdown_wc_document"

Plan:

  • id=2, parent=0, notused=0, detail=CO-ROUTINE w

  • id=5, parent=2, notused=0, detail=CO-ROUTINE (subquery-27)

  • id=7, parent=5, notused=0, detail=CO-ROUTINE c

  • id=8, parent=7, notused=0, detail=COMPOUND QUERY

  • id=9, parent=8, notused=0, detail=LEFT-MOST SUBQUERY

  • id=14, parent=9, notused=216, detail=SCAN unt

  • id=185, parent=8, notused=0, detail=UNION ALL

  • id=186, parent=185, notused=0, detail=COMPOUND QUERY

  • id=187, parent=186, notused=0, detail=LEFT-MOST SUBQUERY

  • id=193, parent=187, notused=62, detail=SEARCH lix_internal_state_cache_v1_markdown_wc_paragraph USING INDEX idx_lix_internal_state_cache_v1_markdown_wc_paragraph_fv (file_id=?)

  • id=370, parent=186, notused=0, detail=UNION ALL

  • id=376, parent=370, notused=62, detail=SEARCH lix_internal_state_cache_v1_markdown_wc_heading USING INDEX idx_lix_internal_state_cache_v1_markdown_wc_heading_fv (file_id=?)

  • id=553, parent=186, notused=0, detail=UNION ALL

  • id=559, parent=553, notused=62, detail=SEARCH lix_internal_state_cache_v1_markdown_wc_document USING INDEX idx_lix_internal_state_cache_v1_markdown_wc_document_fv (file_id=?)

  • id=738, parent=5, notused=196, detail=SCAN c

  • id=858, parent=5, notused=0, detail=USE TEMP B-TREE FOR LAST 10 TERMS OF ORDER BY

  • id=902, parent=2, notused=176, detail=SCAN (subquery-27)

  • id=984, parent=0, notused=176, detail=SCAN w

  • id=1073, parent=0, notused=0, detail=LIST SUBQUERY 24

  • id=1076, parent=1073, notused=0, detail=CO-ROUTINE w

  • id=1079, parent=1076, notused=0, detail=CO-ROUTINE (subquery-30)

  • id=1081, parent=1079, notused=0, detail=CO-ROUTINE c

  • id=1082, parent=1081, notused=0, detail=COMPOUND QUERY

  • id=1083, parent=1082, notused=0, detail=LEFT-MOST SUBQUERY

  • id=1167, parent=1083, notused=61, detail=SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)

  • id=1195, parent=1082, notused=0, detail=UNION ALL

  • id=1196, parent=1195, notused=0, detail=COMPOUND QUERY

  • id=1197, parent=1196, notused=0, detail=LEFT-MOST SUBQUERY

  • id=1281, parent=1197, notused=62, detail=SEARCH lix_internal_state_cache_v1_markdown_wc_paragraph USING INDEX idx_lix_internal_state_cache_v1_markdown_wc_paragraph_vfe (version_id=?)

  • id=1312, parent=1196, notused=0, detail=UNION ALL

  • id=1396, parent=1312, notused=62, detail=SEARCH lix_internal_state_cache_v1_markdown_wc_heading USING INDEX idx_lix_internal_state_cache_v1_markdown_wc_heading_vfe (version_id=?)

  • id=1427, parent=1196, notused=0, detail=UNION ALL

  • id=1511, parent=1427, notused=62, detail=SEARCH lix_internal_state_cache_v1_markdown_wc_document USING INDEX idx_lix_internal_state_cache_v1_markdown_wc_document_vfe (version_id=?)

  • id=1573, parent=1079, notused=49, detail=SEARCH c USING AUTOMATIC PARTIAL COVERING INDEX (version_id=? AND schema_key=?)

  • id=1612, parent=1079, notused=0, detail=USE TEMP B-TREE FOR ORDER BY

  • id=1652, parent=1076, notused=107, detail=SCAN (subquery-30)

  • id=1736, parent=1073, notused=0, detail=BLOOM FILTER ON w (rn=? AND schema_key=? AND version_id=?)

  • id=1771, parent=1073, notused=50, detail=SEARCH w USING AUTOMATIC PARTIAL COVERING INDEX (rn=? AND schema_key=? AND version_id=?)

  • id=1786, parent=1073, notused=0, detail=CREATE BLOOM FILTER

# Query 2

Original SQL (same as executed):
select json_extract(snapshot_content, '$.value') as "value" from "lix_internal_state_vtable" where "entity_id" = ? and "schema_key" = ? and "version_id" = ? and "inherited_from_version_id" is null and "snapshot_content" is not null

Rewritten SQL:
SELECT json_extract(snapshot_content, '$.value') AS "value"
FROM (
SELECT
  w."entity_id" AS "entity_id",
  w."schema_key" AS "schema_key",
  w."file_id" AS "file_id",
  w."plugin_key" AS "plugin_key",
  w."snapshot_content" AS "snapshot_content",
  w."schema_version" AS "schema_version",
  w."version_id" AS "version_id",
  w."created_at" AS "created_at",
  w."updated_at" AS "updated_at",
  w."inherited_from_version_id" AS "inherited_from_version_id",
  w."change_id" AS "change_id",
  w."untracked" AS "untracked",
  w."commit_id" AS "commit_id",
  w."metadata" AS "metadata",
  COALESCE(ws_dst.writer_key, ws_src.writer_key, w.writer_key) AS "writer_key"
FROM (
  SELECT
    c.entity_id AS entity_id,
    c.schema_key AS schema_key,
    c.file_id AS file_id,
    c.plugin_key AS plugin_key,
    c.snapshot_content AS snapshot_content,
    c.schema_version AS schema_version,
    c.version_id AS version_id,
    c.created_at AS created_at,
    c.updated_at AS updated_at,
    c.inherited_from_version_id AS inherited_from_version_id,
    c.change_id AS change_id,
    c.untracked AS untracked,
    c.commit_id AS commit_id,
    c.metadata AS metadata,
    c.writer_key AS writer_key,
    c.priority AS priority,
    ROW_NUMBER() OVER (
            PARTITION BY c.file_id, c.schema_key, c.entity_id, c.version_id
            ORDER BY c.priority, c.created_at DESC, c.file_id, c.schema_key, c.entity_id, c.version_id, c.change_id
          ) AS rn
  FROM (
      SELECT
        unt.entity_id AS entity_id,
        unt.schema_key AS schema_key,
        unt.file_id AS file_id,
        unt.plugin_key AS plugin_key,
        json(unt.snapshot_content) AS snapshot_content,
        unt.schema_version AS schema_version,
        unt.version_id AS version_id,
        unt.created_at AS created_at,
        unt.updated_at AS updated_at,
        NULL AS inherited_from_version_id,
        'untracked' AS change_id,
        1 AS untracked,
        'untracked' AS commit_id,
        NULL AS metadata,
        NULL AS writer_key,
        2 AS priority
      FROM lix_internal_state_all_untracked unt
      WHERE (unt.schema_key IN ('lix_key_value')) AND (unt.version_id IN ('global'))

          UNION ALL

      SELECT
        cache.entity_id AS entity_id,
        cache.schema_key AS schema_key,
        cache.file_id AS file_id,
        cache.plugin_key AS plugin_key,
        json(cache.snapshot_content) AS snapshot_content,
        cache.schema_version AS schema_version,
        cache.version_id AS version_id,
        cache.created_at AS created_at,
        cache.updated_at AS updated_at,
        cache.inherited_from_version_id AS inherited_from_version_id,
        cache.change_id AS change_id,
        0 AS untracked,
        cache.commit_id AS commit_id,
        NULL AS metadata,
        NULL AS writer_key,
        3 AS priority
      FROM "lix_internal_state_cache_v1_lix_key_value" cache
      WHERE (cache.schema_key IN ('lix_key_value')) AND (cache.version_id IN ('global'))
  ) AS c
) AS w

LEFT JOIN lix_internal_state_writer ws_dst ON
  ws_dst.file_id = w.file_id AND
  ws_dst.entity_id = w.entity_id AND
  ws_dst.schema_key = w.schema_key AND
  ws_dst.version_id = w.version_id
LEFT JOIN lix_internal_state_writer ws_src ON
  ws_src.file_id = w.file_id AND
  ws_src.entity_id = w.entity_id AND
  ws_src.schema_key = w.schema_key AND
  ws_src.version_id = w.inherited_from_version_id

LEFT JOIN lix_internal_change chc ON chc.id = w.change_id

WHERE w.rn = 1
) AS "lix_internal_state_vtable"
WHERE "entity_id" = ? AND "schema_key" = ? AND "version_id" = ? AND "inherited_from_version_id" IS NULL AND "snapshot_content" IS NOT NULL

Executed SQL:
select json_extract(snapshot_content, '$.value') as "value" from "lix_internal_state_vtable" where "entity_id" = ? and "schema_key" = ? and "version_id" = ? and "inherited_from_version_id" is null and "snapshot_content" is not null

Parameters:
  $1: "lix_state_cache_stale"
  $2: "lix_key_value"
  $3: "global"

Plan:

  • id=2, parent=0, notused=0, detail=CO-ROUTINE w

  • id=5, parent=2, notused=0, detail=CO-ROUTINE (subquery-6)

  • id=7, parent=5, notused=0, detail=CO-ROUTINE c

  • id=8, parent=7, notused=0, detail=COMPOUND QUERY

  • id=9, parent=8, notused=0, detail=LEFT-MOST SUBQUERY

  • id=18, parent=9, notused=61, detail=SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)

  • id=48, parent=8, notused=0, detail=UNION ALL

  • id=57, parent=48, notused=47, detail=SEARCH cache USING INDEX idx_lix_internal_state_cache_v1_lix_key_value_version_id (version_id=? AND entity_id=?)

  • id=93, parent=5, notused=47, detail=SCAN c

  • id=136, parent=5, notused=0, detail=USE TEMP B-TREE FOR ORDER BY

  • id=176, parent=2, notused=27, detail=SCAN (subquery-6)

  • id=258, parent=0, notused=27, detail=SCAN w