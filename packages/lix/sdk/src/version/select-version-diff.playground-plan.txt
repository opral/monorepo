-- original SQL --
select * from (
WITH
  -- Source side should expose explicit deletions (tombstones)
  -- Use state_with_tombstones to include rows with NULL snapshot_content
  s AS (
    SELECT entity_id, schema_key, file_id, change_id, commit_id, version_id, snapshot_content
    FROM state_with_tombstones
    WHERE version_id = 'test_0000000017'
  ),
  t AS (
    SELECT entity_id, schema_key, file_id, change_id, commit_id, version_id
    FROM state_all
    WHERE version_id = 'test_0000000047'
  ),
  joined AS (
    SELECT
      COALESCE(s.entity_id, t.entity_id) AS entity_id,
      COALESCE(s.schema_key, t.schema_key) AS schema_key,
      COALESCE(s.file_id, t.file_id) AS file_id,
      t.version_id AS before_version_id,
      t.change_id AS before_change_id,
      t.commit_id AS before_commit_id,
      s.version_id AS after_version_id,
      s.change_id AS after_change_id,
      s.commit_id AS after_commit_id,
      CASE
        -- Explicit delete in source (tombstone takes precedence)
        WHEN s.snapshot_content IS NULL THEN 'removed'
        -- Added in source only (live row)
        WHEN t.change_id IS NULL AND s.snapshot_content IS NOT NULL THEN 'added'
        -- Both present and different (live row in source)
        WHEN t.change_id IS NOT NULL AND s.snapshot_content IS NOT NULL AND s.change_id != t.change_id THEN 'modified'
        -- Both present and same (live row in source)
        ELSE 'unchanged'
      END AS status
    FROM s
    LEFT JOIN t ON t.entity_id = s.entity_id AND t.schema_key = s.schema_key AND t.file_id = s.file_id
    UNION ALL
    SELECT
      COALESCE(s.entity_id, t.entity_id) AS entity_id,
      COALESCE(s.schema_key, t.schema_key) AS schema_key,
      COALESCE(s.file_id, t.file_id) AS file_id,
      t.version_id AS before_version_id,
      t.change_id AS before_change_id,
      t.commit_id AS before_commit_id,
      -- For target-only rows (no source contribution), mirror target values for after_*
      -- This represents entities that exist in target but were never in source
      t.version_id AS after_version_id,
      t.change_id AS after_change_id,
      t.commit_id AS after_commit_id,
      CASE
        -- Target-only: entity exists in target but never existed in source (no explicit delete)
        -- Treated as unchanged since source doesn't modify it
        WHEN s.change_id IS NULL AND t.change_id IS NOT NULL THEN 'unchanged'
        ELSE 'unchanged'
      END AS status
    FROM t
    LEFT JOIN s ON s.entity_id = t.entity_id AND s.schema_key = t.schema_key AND s.file_id = t.file_id
    WHERE s.change_id IS NULL
  )
SELECT *
FROM joined
    ) as "diff" where "diff"."status" != ?

-- rewritten SQL --
select * from (
WITH
  -- Source side should expose explicit deletions (tombstones)
  -- Use state_with_tombstones to include rows with NULL snapshot_content
  s AS (
    SELECT entity_id, schema_key, file_id, change_id, commit_id, version_id, snapshot_content
    FROM ( SELECT 
      entity_id,
      schema_key,
      file_id,
      version_id,
      plugin_key,
      snapshot_content,
      schema_version,
      created_at,
      updated_at,
      inherited_from_version_id,
      change_id,
      untracked,
      commit_id,
      writer_key,
      (
        SELECT json(metadata)
        FROM change
        WHERE change.id = internal_state_vtable.change_id
      ) AS metadata
    FROM (    SELECT entity_id, schema_key, file_id, plugin_key, snapshot_content, schema_version, version_id, created_at, updated_at, inherited_from_version_id, change_id, untracked, commit_id, metadata, writer_key
    FROM (
      WITH RECURSIVE
  version_descriptor_base AS (
    SELECT
      json_extract(isc_v.snapshot_content, '$.id') AS version_id,
      json_extract(isc_v.snapshot_content, '$.inherits_from_version_id') AS inherits_from_version_id
    FROM internal_state_cache isc_v
    WHERE isc_v.schema_key = 'lix_version_descriptor'
  ),
  version_inheritance(version_id, ancestor_version_id) AS (
    SELECT
      vdb.version_id,
      vdb.inherits_from_version_id
    FROM version_descriptor_base vdb
    WHERE vdb.inherits_from_version_id IS NOT NULL

    UNION

    SELECT
      vir.version_id,
      vdb.inherits_from_version_id
    FROM version_inheritance vir
    JOIN version_descriptor_base vdb ON vdb.version_id = vir.ancestor_version_id
    WHERE vdb.inherits_from_version_id IS NOT NULL
  ),
  version_parent AS (
    SELECT
      vdb.version_id,
      vdb.inherits_from_version_id AS parent_version_id
    FROM version_descriptor_base vdb
    WHERE vdb.inherits_from_version_id IS NOT NULL
  )

      SELECT * FROM (
-- 1. Transaction state (highest priority) - pending changes
SELECT 
  'T' || '~' || lix_encode_pk_part(txn.file_id) || '~' || lix_encode_pk_part(txn.entity_id) || '~' || lix_encode_pk_part(txn.version_id) AS _pk,
  txn.entity_id,
  txn.schema_key,
  txn.file_id,
  txn.plugin_key,
  json(txn.snapshot_content) AS snapshot_content,
  txn.schema_version,
  txn.version_id,
  txn.created_at,
  txn.created_at AS updated_at,
  NULL AS inherited_from_version_id,
  txn.id AS change_id,
  txn.untracked,
  'pending' AS commit_id,
  json(txn.metadata) AS metadata,
  ws_txn.writer_key
FROM internal_transaction_state txn
LEFT JOIN internal_state_writer ws_txn ON
  ws_txn.file_id = txn.file_id AND
  ws_txn.entity_id = txn.entity_id AND
  ws_txn.schema_key = txn.schema_key AND
  ws_txn.version_id = txn.version_id


		UNION ALL

-- 2. Untracked state (second priority) - only if no transaction exists
SELECT 
  'U' || '~' || lix_encode_pk_part(u.file_id) || '~' || lix_encode_pk_part(u.entity_id) || '~' || lix_encode_pk_part(u.version_id) AS _pk,
  u.entity_id,
  u.schema_key,
  u.file_id,
  u.plugin_key,
  json(u.snapshot_content) AS snapshot_content,
  u.schema_version,
  u.version_id,
  u.created_at,
  u.updated_at,
  NULL AS inherited_from_version_id,
  'untracked' AS change_id,
  1 AS untracked,
  'untracked' AS commit_id,
  NULL AS metadata,
  ws_untracked.writer_key
FROM internal_state_all_untracked u
LEFT JOIN internal_state_writer ws_untracked ON
  ws_untracked.file_id = u.file_id AND
  ws_untracked.entity_id = u.entity_id AND
  ws_untracked.schema_key = u.schema_key AND
  ws_untracked.version_id = u.version_id
WHERE (
  (u.inheritance_delete_marker = 0 AND u.snapshot_content IS NOT NULL) OR
  (u.inheritance_delete_marker = 1 AND u.snapshot_content IS NULL)
)
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = u.version_id
      AND t.file_id = u.file_id
      AND t.schema_key = u.schema_key
      AND t.entity_id = u.entity_id
  )


		UNION ALL

-- 3. Tracked state from cache (third priority) - only if no transaction or untracked exists
SELECT 
  'C' || '~' || lix_encode_pk_part(c.file_id) || '~' || lix_encode_pk_part(c.entity_id) || '~' || lix_encode_pk_part(c.version_id) AS _pk,
  c.entity_id,
  c.schema_key,
  c.file_id,
  c.plugin_key,
  json(c.snapshot_content) AS snapshot_content,
  c.schema_version,
  c.version_id,
  c.created_at,
  c.updated_at,
  c.inherited_from_version_id,
  c.change_id,
  0 AS untracked,
  c.commit_id,
  ch.metadata AS metadata,
  ws_cache.writer_key
FROM internal_state_cache c
LEFT JOIN change ch ON ch.id = c.change_id
LEFT JOIN internal_state_writer ws_cache ON
  ws_cache.file_id = c.file_id AND
  ws_cache.entity_id = c.entity_id AND
  ws_cache.schema_key = c.schema_key AND
  ws_cache.version_id = c.version_id
WHERE (
  (c.inheritance_delete_marker = 0 AND c.snapshot_content IS NOT NULL) OR
  (c.inheritance_delete_marker = 1 AND c.snapshot_content IS NULL)
)
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = c.version_id
      AND t.file_id = c.file_id
      AND t.schema_key = c.schema_key
      AND t.entity_id = c.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked u
    WHERE u.version_id = c.version_id
      AND u.file_id = c.file_id
      AND u.schema_key = c.schema_key
      AND u.entity_id = c.entity_id
  )


		UNION ALL

-- 4. Inherited tracked state (fourth priority)
SELECT 
  'CI' || '~' || lix_encode_pk_part(isc.file_id) || '~' || lix_encode_pk_part(isc.entity_id) || '~' || lix_encode_pk_part(vi.version_id) AS _pk,
  isc.entity_id,
  isc.schema_key,
  isc.file_id,
  isc.plugin_key,
  json(isc.snapshot_content) AS snapshot_content,
  isc.schema_version,
  vi.version_id,
  isc.created_at,
  isc.updated_at,
  isc.version_id AS inherited_from_version_id,
  isc.change_id,
  0 AS untracked,
  isc.commit_id,
  ch.metadata AS metadata,
  COALESCE(ws_child.writer_key, ws_parent.writer_key) AS writer_key
FROM version_inheritance vi
JOIN internal_state_cache isc ON isc.version_id = vi.ancestor_version_id
LEFT JOIN change ch ON ch.id = isc.change_id
LEFT JOIN internal_state_writer ws_child ON
  ws_child.file_id = isc.file_id AND
  ws_child.entity_id = isc.entity_id AND
  ws_child.schema_key = isc.schema_key AND
  ws_child.version_id = vi.version_id
LEFT JOIN internal_state_writer ws_parent ON
  ws_parent.file_id = isc.file_id AND
  ws_parent.entity_id = isc.entity_id AND
  ws_parent.schema_key = isc.schema_key AND
  ws_parent.version_id = isc.version_id
WHERE isc.inheritance_delete_marker = 0
  AND isc.snapshot_content IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = vi.version_id
      AND t.file_id = isc.file_id
      AND t.schema_key = isc.schema_key
      AND t.entity_id = isc.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_cache child_isc
    WHERE child_isc.version_id = vi.version_id
      AND child_isc.file_id = isc.file_id
      AND child_isc.schema_key = isc.schema_key
      AND child_isc.entity_id = isc.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked child_unt
    WHERE child_unt.version_id = vi.version_id
      AND child_unt.file_id = isc.file_id
      AND child_unt.schema_key = isc.schema_key
      AND child_unt.entity_id = isc.entity_id
  )


		UNION ALL

-- 5. Inherited untracked state (lowest priority)
SELECT 
  'UI' || '~' || lix_encode_pk_part(unt.file_id) || '~' || lix_encode_pk_part(unt.entity_id) || '~' || lix_encode_pk_part(vi.version_id) AS _pk,
  unt.entity_id,
  unt.schema_key,
  unt.file_id,
  unt.plugin_key,
  json(unt.snapshot_content) AS snapshot_content,
  unt.schema_version,
  vi.version_id,
  unt.created_at,
  unt.updated_at,
  unt.version_id AS inherited_from_version_id,
  'untracked' AS change_id,
  1 AS untracked,
  'untracked' AS commit_id,
  NULL AS metadata,
  COALESCE(ws_child.writer_key, ws_parent.writer_key) AS writer_key
FROM version_inheritance vi
JOIN internal_state_all_untracked unt ON unt.version_id = vi.ancestor_version_id
LEFT JOIN internal_state_writer ws_child ON
  ws_child.file_id = unt.file_id AND
  ws_child.entity_id = unt.entity_id AND
  ws_child.schema_key = unt.schema_key AND
  ws_child.version_id = vi.version_id
LEFT JOIN internal_state_writer ws_parent ON
  ws_parent.file_id = unt.file_id AND
  ws_parent.entity_id = unt.entity_id AND
  ws_parent.schema_key = unt.schema_key AND
  ws_parent.version_id = unt.version_id
WHERE unt.inheritance_delete_marker = 0
  AND unt.snapshot_content IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = vi.version_id
      AND t.file_id = unt.file_id
      AND t.schema_key = unt.schema_key
      AND t.entity_id = unt.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_cache child_isc
    WHERE child_isc.version_id = vi.version_id
      AND child_isc.file_id = unt.file_id
      AND child_isc.schema_key = unt.schema_key
      AND child_isc.entity_id = unt.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked child_unt
    WHERE child_unt.version_id = vi.version_id
      AND child_unt.file_id = unt.file_id
      AND child_unt.schema_key = unt.schema_key
      AND child_unt.entity_id = unt.entity_id
  )


		UNION ALL

-- 6. Inherited transaction state
SELECT 
  'TI' || '~' || lix_encode_pk_part(txn.file_id) || '~' || lix_encode_pk_part(txn.entity_id) || '~' || lix_encode_pk_part(vi.version_id) AS _pk,
  txn.entity_id,
  txn.schema_key,
  txn.file_id,
  txn.plugin_key,
  json(txn.snapshot_content) AS snapshot_content,
  txn.schema_version,
  vi.version_id,
  txn.created_at,
  txn.created_at AS updated_at,
  vi.parent_version_id AS inherited_from_version_id,
  txn.id AS change_id,
  txn.untracked,
  'pending' AS commit_id,
  json(txn.metadata) AS metadata,
  COALESCE(ws_child.writer_key, ws_parent.writer_key) AS writer_key
FROM version_parent vi
JOIN internal_transaction_state txn ON txn.version_id = vi.parent_version_id
LEFT JOIN internal_state_writer ws_child ON
  ws_child.file_id = txn.file_id AND
  ws_child.entity_id = txn.entity_id AND
  ws_child.schema_key = txn.schema_key AND
  ws_child.version_id = vi.version_id
LEFT JOIN internal_state_writer ws_parent ON
  ws_parent.file_id = txn.file_id AND
  ws_parent.entity_id = txn.entity_id AND
  ws_parent.schema_key = txn.schema_key AND
  ws_parent.version_id = vi.parent_version_id
WHERE vi.parent_version_id IS NOT NULL
  AND txn.snapshot_content IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state child_txn
    WHERE child_txn.version_id = vi.version_id
      AND child_txn.file_id = txn.file_id
      AND child_txn.schema_key = txn.schema_key
      AND child_txn.entity_id = txn.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_cache child_isc
    WHERE child_isc.version_id = vi.version_id
      AND child_isc.file_id = txn.file_id
      AND child_isc.schema_key = txn.schema_key
      AND child_isc.entity_id = txn.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked child_unt
    WHERE child_unt.version_id = vi.version_id
      AND child_unt.file_id = txn.file_id
      AND child_unt.schema_key = txn.schema_key
      AND child_unt.entity_id = txn.entity_id
  )

		)
    )
  ) AS internal_state_vtable ) AS state_with_tombstones
    WHERE version_id = 'test_0000000017'
  ),
  t AS (
    SELECT entity_id, schema_key, file_id, change_id, commit_id, version_id
    FROM ( SELECT 
      entity_id,
      schema_key,
      file_id,
      version_id,
      plugin_key,
      snapshot_content,
      schema_version,
      created_at,
      updated_at,
      inherited_from_version_id,
      change_id,
      untracked,
      commit_id,
      writer_key,
      (
        SELECT json(metadata)
        FROM change
        WHERE change.id = internal_state_vtable.change_id
      ) AS metadata
    FROM (    SELECT entity_id, schema_key, file_id, plugin_key, snapshot_content, schema_version, version_id, created_at, updated_at, inherited_from_version_id, change_id, untracked, commit_id, metadata, writer_key
    FROM (
      WITH RECURSIVE
  version_descriptor_base AS (
    SELECT
      json_extract(isc_v.snapshot_content, '$.id') AS version_id,
      json_extract(isc_v.snapshot_content, '$.inherits_from_version_id') AS inherits_from_version_id
    FROM internal_state_cache isc_v
    WHERE isc_v.schema_key = 'lix_version_descriptor'
  ),
  version_inheritance(version_id, ancestor_version_id) AS (
    SELECT
      vdb.version_id,
      vdb.inherits_from_version_id
    FROM version_descriptor_base vdb
    WHERE vdb.inherits_from_version_id IS NOT NULL

    UNION

    SELECT
      vir.version_id,
      vdb.inherits_from_version_id
    FROM version_inheritance vir
    JOIN version_descriptor_base vdb ON vdb.version_id = vir.ancestor_version_id
    WHERE vdb.inherits_from_version_id IS NOT NULL
  ),
  version_parent AS (
    SELECT
      vdb.version_id,
      vdb.inherits_from_version_id AS parent_version_id
    FROM version_descriptor_base vdb
    WHERE vdb.inherits_from_version_id IS NOT NULL
  )

      SELECT * FROM (
-- 1. Transaction state (highest priority) - pending changes
SELECT 
  'T' || '~' || lix_encode_pk_part(txn.file_id) || '~' || lix_encode_pk_part(txn.entity_id) || '~' || lix_encode_pk_part(txn.version_id) AS _pk,
  txn.entity_id,
  txn.schema_key,
  txn.file_id,
  txn.plugin_key,
  json(txn.snapshot_content) AS snapshot_content,
  txn.schema_version,
  txn.version_id,
  txn.created_at,
  txn.created_at AS updated_at,
  NULL AS inherited_from_version_id,
  txn.id AS change_id,
  txn.untracked,
  'pending' AS commit_id,
  json(txn.metadata) AS metadata,
  ws_txn.writer_key
FROM internal_transaction_state txn
LEFT JOIN internal_state_writer ws_txn ON
  ws_txn.file_id = txn.file_id AND
  ws_txn.entity_id = txn.entity_id AND
  ws_txn.schema_key = txn.schema_key AND
  ws_txn.version_id = txn.version_id


		UNION ALL

-- 2. Untracked state (second priority) - only if no transaction exists
SELECT 
  'U' || '~' || lix_encode_pk_part(u.file_id) || '~' || lix_encode_pk_part(u.entity_id) || '~' || lix_encode_pk_part(u.version_id) AS _pk,
  u.entity_id,
  u.schema_key,
  u.file_id,
  u.plugin_key,
  json(u.snapshot_content) AS snapshot_content,
  u.schema_version,
  u.version_id,
  u.created_at,
  u.updated_at,
  NULL AS inherited_from_version_id,
  'untracked' AS change_id,
  1 AS untracked,
  'untracked' AS commit_id,
  NULL AS metadata,
  ws_untracked.writer_key
FROM internal_state_all_untracked u
LEFT JOIN internal_state_writer ws_untracked ON
  ws_untracked.file_id = u.file_id AND
  ws_untracked.entity_id = u.entity_id AND
  ws_untracked.schema_key = u.schema_key AND
  ws_untracked.version_id = u.version_id
WHERE (
  (u.inheritance_delete_marker = 0 AND u.snapshot_content IS NOT NULL) OR
  (u.inheritance_delete_marker = 1 AND u.snapshot_content IS NULL)
)
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = u.version_id
      AND t.file_id = u.file_id
      AND t.schema_key = u.schema_key
      AND t.entity_id = u.entity_id
  )


		UNION ALL

-- 3. Tracked state from cache (third priority) - only if no transaction or untracked exists
SELECT 
  'C' || '~' || lix_encode_pk_part(c.file_id) || '~' || lix_encode_pk_part(c.entity_id) || '~' || lix_encode_pk_part(c.version_id) AS _pk,
  c.entity_id,
  c.schema_key,
  c.file_id,
  c.plugin_key,
  json(c.snapshot_content) AS snapshot_content,
  c.schema_version,
  c.version_id,
  c.created_at,
  c.updated_at,
  c.inherited_from_version_id,
  c.change_id,
  0 AS untracked,
  c.commit_id,
  ch.metadata AS metadata,
  ws_cache.writer_key
FROM internal_state_cache c
LEFT JOIN change ch ON ch.id = c.change_id
LEFT JOIN internal_state_writer ws_cache ON
  ws_cache.file_id = c.file_id AND
  ws_cache.entity_id = c.entity_id AND
  ws_cache.schema_key = c.schema_key AND
  ws_cache.version_id = c.version_id
WHERE (
  (c.inheritance_delete_marker = 0 AND c.snapshot_content IS NOT NULL) OR
  (c.inheritance_delete_marker = 1 AND c.snapshot_content IS NULL)
)
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = c.version_id
      AND t.file_id = c.file_id
      AND t.schema_key = c.schema_key
      AND t.entity_id = c.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked u
    WHERE u.version_id = c.version_id
      AND u.file_id = c.file_id
      AND u.schema_key = c.schema_key
      AND u.entity_id = c.entity_id
  )


		UNION ALL

-- 4. Inherited tracked state (fourth priority)
SELECT 
  'CI' || '~' || lix_encode_pk_part(isc.file_id) || '~' || lix_encode_pk_part(isc.entity_id) || '~' || lix_encode_pk_part(vi.version_id) AS _pk,
  isc.entity_id,
  isc.schema_key,
  isc.file_id,
  isc.plugin_key,
  json(isc.snapshot_content) AS snapshot_content,
  isc.schema_version,
  vi.version_id,
  isc.created_at,
  isc.updated_at,
  isc.version_id AS inherited_from_version_id,
  isc.change_id,
  0 AS untracked,
  isc.commit_id,
  ch.metadata AS metadata,
  COALESCE(ws_child.writer_key, ws_parent.writer_key) AS writer_key
FROM version_inheritance vi
JOIN internal_state_cache isc ON isc.version_id = vi.ancestor_version_id
LEFT JOIN change ch ON ch.id = isc.change_id
LEFT JOIN internal_state_writer ws_child ON
  ws_child.file_id = isc.file_id AND
  ws_child.entity_id = isc.entity_id AND
  ws_child.schema_key = isc.schema_key AND
  ws_child.version_id = vi.version_id
LEFT JOIN internal_state_writer ws_parent ON
  ws_parent.file_id = isc.file_id AND
  ws_parent.entity_id = isc.entity_id AND
  ws_parent.schema_key = isc.schema_key AND
  ws_parent.version_id = isc.version_id
WHERE isc.inheritance_delete_marker = 0
  AND isc.snapshot_content IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = vi.version_id
      AND t.file_id = isc.file_id
      AND t.schema_key = isc.schema_key
      AND t.entity_id = isc.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_cache child_isc
    WHERE child_isc.version_id = vi.version_id
      AND child_isc.file_id = isc.file_id
      AND child_isc.schema_key = isc.schema_key
      AND child_isc.entity_id = isc.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked child_unt
    WHERE child_unt.version_id = vi.version_id
      AND child_unt.file_id = isc.file_id
      AND child_unt.schema_key = isc.schema_key
      AND child_unt.entity_id = isc.entity_id
  )


		UNION ALL

-- 5. Inherited untracked state (lowest priority)
SELECT 
  'UI' || '~' || lix_encode_pk_part(unt.file_id) || '~' || lix_encode_pk_part(unt.entity_id) || '~' || lix_encode_pk_part(vi.version_id) AS _pk,
  unt.entity_id,
  unt.schema_key,
  unt.file_id,
  unt.plugin_key,
  json(unt.snapshot_content) AS snapshot_content,
  unt.schema_version,
  vi.version_id,
  unt.created_at,
  unt.updated_at,
  unt.version_id AS inherited_from_version_id,
  'untracked' AS change_id,
  1 AS untracked,
  'untracked' AS commit_id,
  NULL AS metadata,
  COALESCE(ws_child.writer_key, ws_parent.writer_key) AS writer_key
FROM version_inheritance vi
JOIN internal_state_all_untracked unt ON unt.version_id = vi.ancestor_version_id
LEFT JOIN internal_state_writer ws_child ON
  ws_child.file_id = unt.file_id AND
  ws_child.entity_id = unt.entity_id AND
  ws_child.schema_key = unt.schema_key AND
  ws_child.version_id = vi.version_id
LEFT JOIN internal_state_writer ws_parent ON
  ws_parent.file_id = unt.file_id AND
  ws_parent.entity_id = unt.entity_id AND
  ws_parent.schema_key = unt.schema_key AND
  ws_parent.version_id = unt.version_id
WHERE unt.inheritance_delete_marker = 0
  AND unt.snapshot_content IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state t
    WHERE t.version_id = vi.version_id
      AND t.file_id = unt.file_id
      AND t.schema_key = unt.schema_key
      AND t.entity_id = unt.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_cache child_isc
    WHERE child_isc.version_id = vi.version_id
      AND child_isc.file_id = unt.file_id
      AND child_isc.schema_key = unt.schema_key
      AND child_isc.entity_id = unt.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked child_unt
    WHERE child_unt.version_id = vi.version_id
      AND child_unt.file_id = unt.file_id
      AND child_unt.schema_key = unt.schema_key
      AND child_unt.entity_id = unt.entity_id
  )


		UNION ALL

-- 6. Inherited transaction state
SELECT 
  'TI' || '~' || lix_encode_pk_part(txn.file_id) || '~' || lix_encode_pk_part(txn.entity_id) || '~' || lix_encode_pk_part(vi.version_id) AS _pk,
  txn.entity_id,
  txn.schema_key,
  txn.file_id,
  txn.plugin_key,
  json(txn.snapshot_content) AS snapshot_content,
  txn.schema_version,
  vi.version_id,
  txn.created_at,
  txn.created_at AS updated_at,
  vi.parent_version_id AS inherited_from_version_id,
  txn.id AS change_id,
  txn.untracked,
  'pending' AS commit_id,
  json(txn.metadata) AS metadata,
  COALESCE(ws_child.writer_key, ws_parent.writer_key) AS writer_key
FROM version_parent vi
JOIN internal_transaction_state txn ON txn.version_id = vi.parent_version_id
LEFT JOIN internal_state_writer ws_child ON
  ws_child.file_id = txn.file_id AND
  ws_child.entity_id = txn.entity_id AND
  ws_child.schema_key = txn.schema_key AND
  ws_child.version_id = vi.version_id
LEFT JOIN internal_state_writer ws_parent ON
  ws_parent.file_id = txn.file_id AND
  ws_parent.entity_id = txn.entity_id AND
  ws_parent.schema_key = txn.schema_key AND
  ws_parent.version_id = vi.parent_version_id
WHERE vi.parent_version_id IS NOT NULL
  AND txn.snapshot_content IS NOT NULL
  AND NOT EXISTS (
    SELECT 1 FROM internal_transaction_state child_txn
    WHERE child_txn.version_id = vi.version_id
      AND child_txn.file_id = txn.file_id
      AND child_txn.schema_key = txn.schema_key
      AND child_txn.entity_id = txn.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_cache child_isc
    WHERE child_isc.version_id = vi.version_id
      AND child_isc.file_id = txn.file_id
      AND child_isc.schema_key = txn.schema_key
      AND child_isc.entity_id = txn.entity_id
  )
  AND NOT EXISTS (
    SELECT 1 FROM internal_state_all_untracked child_unt
    WHERE child_unt.version_id = vi.version_id
      AND child_unt.file_id = txn.file_id
      AND child_unt.schema_key = txn.schema_key
      AND child_unt.entity_id = txn.entity_id
  )

		)
    )
  ) AS internal_state_vtable
    WHERE snapshot_content IS NOT NULL ) AS state_all
    WHERE version_id = 'test_0000000047'
  ),
  joined AS (
    SELECT
      COALESCE(s.entity_id, t.entity_id) AS entity_id,
      COALESCE(s.schema_key, t.schema_key) AS schema_key,
      COALESCE(s.file_id, t.file_id) AS file_id,
      t.version_id AS before_version_id,
      t.change_id AS before_change_id,
      t.commit_id AS before_commit_id,
      s.version_id AS after_version_id,
      s.change_id AS after_change_id,
      s.commit_id AS after_commit_id,
      CASE
        -- Explicit delete in source (tombstone takes precedence)
        WHEN s.snapshot_content IS NULL THEN 'removed'
        -- Added in source only (live row)
        WHEN t.change_id IS NULL AND s.snapshot_content IS NOT NULL THEN 'added'
        -- Both present and different (live row in source)
        WHEN t.change_id IS NOT NULL AND s.snapshot_content IS NOT NULL AND s.change_id != t.change_id THEN 'modified'
        -- Both present and same (live row in source)
        ELSE 'unchanged'
      END AS status
    FROM s
    LEFT JOIN t ON t.entity_id = s.entity_id AND t.schema_key = s.schema_key AND t.file_id = s.file_id
    UNION ALL
    SELECT
      COALESCE(s.entity_id, t.entity_id) AS entity_id,
      COALESCE(s.schema_key, t.schema_key) AS schema_key,
      COALESCE(s.file_id, t.file_id) AS file_id,
      t.version_id AS before_version_id,
      t.change_id AS before_change_id,
      t.commit_id AS before_commit_id,
      -- For target-only rows (no source contribution), mirror target values for after_*
      -- This represents entities that exist in target but were never in source
      t.version_id AS after_version_id,
      t.change_id AS after_change_id,
      t.commit_id AS after_commit_id,
      CASE
        -- Target-only: entity exists in target but never existed in source (no explicit delete)
        -- Treated as unchanged since source doesn't modify it
        WHEN s.change_id IS NULL AND t.change_id IS NOT NULL THEN 'unchanged'
        ELSE 'unchanged'
      END AS status
    FROM t
    LEFT JOIN s ON s.entity_id = t.entity_id AND s.schema_key = t.schema_key AND s.file_id = t.file_id
    WHERE s.change_id IS NULL
  )
SELECT *
FROM joined
    ) as "diff" where "diff"."status" != ?

-- plan --
[
  {
    "id": 1,
    "parent": 0,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2,
    "parent": 1,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 4,
    "parent": 2,
    "notused": 0,
    "detail": "CO-ROUTINE (subquery-23)"
  },
  {
    "id": 5,
    "parent": 4,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 6,
    "parent": 5,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 9,
    "parent": 6,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 33,
    "parent": 5,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 36,
    "parent": 33,
    "notused": 61,
    "detail": "SEARCH u USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 50,
    "parent": 33,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 7"
  },
  {
    "id": 54,
    "parent": 50,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 85,
    "parent": 5,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 88,
    "parent": 85,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 90,
    "parent": 88,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 91,
    "parent": 90,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 95,
    "parent": 91,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 97,
    "parent": 91,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 122,
    "parent": 90,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 124,
    "parent": 122,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 144,
    "parent": 85,
    "notused": 189,
    "detail": "SCAN c VIRTUAL TABLE INDEX 0:version_id"
  },
  {
    "id": 160,
    "parent": 85,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 9"
  },
  {
    "id": 164,
    "parent": 160,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 177,
    "parent": 85,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 10"
  },
  {
    "id": 181,
    "parent": 177,
    "notused": 45,
    "detail": "SEARCH u USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 211,
    "parent": 85,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 241,
    "parent": 5,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 244,
    "parent": 241,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 249,
    "parent": 244,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 251,
    "parent": 249,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 280,
    "parent": 244,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 282,
    "parent": 280,
    "notused": 216,
    "detail": "SCAN vir"
  },
  {
    "id": 283,
    "parent": 280,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 309,
    "parent": 241,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 311,
    "parent": 309,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 312,
    "parent": 311,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 316,
    "parent": 312,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 318,
    "parent": 312,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 343,
    "parent": 311,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 345,
    "parent": 343,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 367,
    "parent": 241,
    "notused": 189,
    "detail": "SCAN isc VIRTUAL TABLE INDEX 0:inheritance_delete_marker"
  },
  {
    "id": 380,
    "parent": 241,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 392,
    "parent": 241,
    "notused": 55,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 401,
    "parent": 241,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 12"
  },
  {
    "id": 405,
    "parent": 401,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 419,
    "parent": 241,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 13"
  },
  {
    "id": 423,
    "parent": 419,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 446,
    "parent": 241,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 14"
  },
  {
    "id": 450,
    "parent": 446,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 481,
    "parent": 241,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 488,
    "parent": 241,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 499,
    "parent": 241,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 538,
    "parent": 5,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 545,
    "parent": 538,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 549,
    "parent": 538,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 561,
    "parent": 538,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 16"
  },
  {
    "id": 565,
    "parent": 561,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 579,
    "parent": 538,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 17"
  },
  {
    "id": 583,
    "parent": 579,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 606,
    "parent": 538,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 18"
  },
  {
    "id": 610,
    "parent": 606,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 623,
    "parent": 538,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 634,
    "parent": 538,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 669,
    "parent": 5,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 675,
    "parent": 669,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 689,
    "parent": 669,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 701,
    "parent": 669,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 20"
  },
  {
    "id": 705,
    "parent": 701,
    "notused": 45,
    "detail": "SEARCH child_txn USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 721,
    "parent": 669,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 21"
  },
  {
    "id": 725,
    "parent": 721,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 751,
    "parent": 669,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 22"
  },
  {
    "id": 755,
    "parent": 751,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 770,
    "parent": 669,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 784,
    "parent": 669,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 829,
    "parent": 2,
    "notused": 0,
    "detail": "MATERIALIZE (subquery-50)"
  },
  {
    "id": 831,
    "parent": 829,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 832,
    "parent": 831,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 835,
    "parent": 832,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 864,
    "parent": 831,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 867,
    "parent": 864,
    "notused": 61,
    "detail": "SEARCH u USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 884,
    "parent": 864,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 34"
  },
  {
    "id": 888,
    "parent": 884,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 921,
    "parent": 831,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 924,
    "parent": 921,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 926,
    "parent": 924,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 927,
    "parent": 926,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 931,
    "parent": 927,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 933,
    "parent": 927,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 958,
    "parent": 926,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 960,
    "parent": 958,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 980,
    "parent": 921,
    "notused": 189,
    "detail": "SCAN c VIRTUAL TABLE INDEX 0:version_id"
  },
  {
    "id": 999,
    "parent": 921,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 36"
  },
  {
    "id": 1003,
    "parent": 999,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 1016,
    "parent": 921,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 37"
  },
  {
    "id": 1020,
    "parent": 1016,
    "notused": 45,
    "detail": "SEARCH u USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 1050,
    "parent": 921,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 1082,
    "parent": 831,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1085,
    "parent": 1082,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 1090,
    "parent": 1085,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 1092,
    "parent": 1090,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 1121,
    "parent": 1085,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 1123,
    "parent": 1121,
    "notused": 216,
    "detail": "SCAN vir"
  },
  {
    "id": 1124,
    "parent": 1121,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 1150,
    "parent": 1082,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 1152,
    "parent": 1150,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 1153,
    "parent": 1152,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 1157,
    "parent": 1153,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 1159,
    "parent": 1153,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 1184,
    "parent": 1152,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1186,
    "parent": 1184,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 1208,
    "parent": 1082,
    "notused": 189,
    "detail": "SCAN isc VIRTUAL TABLE INDEX 0:inheritance_delete_marker"
  },
  {
    "id": 1224,
    "parent": 1082,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1236,
    "parent": 1082,
    "notused": 55,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1245,
    "parent": 1082,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 39"
  },
  {
    "id": 1249,
    "parent": 1245,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 1263,
    "parent": 1082,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 40"
  },
  {
    "id": 1267,
    "parent": 1263,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 1290,
    "parent": 1082,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 41"
  },
  {
    "id": 1294,
    "parent": 1290,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 1325,
    "parent": 1082,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 1332,
    "parent": 1082,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 1343,
    "parent": 1082,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 1384,
    "parent": 831,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1391,
    "parent": 1384,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 1395,
    "parent": 1384,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 1410,
    "parent": 1384,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 43"
  },
  {
    "id": 1414,
    "parent": 1410,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 1428,
    "parent": 1384,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 44"
  },
  {
    "id": 1432,
    "parent": 1428,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 1455,
    "parent": 1384,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 45"
  },
  {
    "id": 1459,
    "parent": 1455,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 1472,
    "parent": 1384,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 1483,
    "parent": 1384,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 1520,
    "parent": 831,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1526,
    "parent": 1520,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 1540,
    "parent": 1520,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 1555,
    "parent": 1520,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 47"
  },
  {
    "id": 1559,
    "parent": 1555,
    "notused": 45,
    "detail": "SEARCH child_txn USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 1575,
    "parent": 1520,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 48"
  },
  {
    "id": 1579,
    "parent": 1575,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 1605,
    "parent": 1520,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 49"
  },
  {
    "id": 1609,
    "parent": 1605,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 1624,
    "parent": 1520,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 1638,
    "parent": 1520,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 1683,
    "parent": 2,
    "notused": 325,
    "detail": "SCAN (subquery-23)"
  },
  {
    "id": 1692,
    "parent": 2,
    "notused": 0,
    "detail": "BLOOM FILTER ON (subquery-50) (version_id=? AND entity_id=? AND schema_key=? AND file_id=?)"
  },
  {
    "id": 1721,
    "parent": 2,
    "notused": 56,
    "detail": "SEARCH (subquery-50) USING AUTOMATIC PARTIAL COVERING INDEX (version_id=? AND entity_id=? AND schema_key=? AND file_id=?) LEFT-JOIN"
  },
  {
    "id": 1802,
    "parent": 1,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1804,
    "parent": 1802,
    "notused": 0,
    "detail": "CO-ROUTINE (subquery-50)"
  },
  {
    "id": 1805,
    "parent": 1804,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 1806,
    "parent": 1805,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 1809,
    "parent": 1806,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 1836,
    "parent": 1805,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1839,
    "parent": 1836,
    "notused": 61,
    "detail": "SEARCH u USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 1856,
    "parent": 1836,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 34"
  },
  {
    "id": 1860,
    "parent": 1856,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 1891,
    "parent": 1805,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1894,
    "parent": 1891,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 1896,
    "parent": 1894,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 1897,
    "parent": 1896,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 1901,
    "parent": 1897,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 1903,
    "parent": 1897,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 1928,
    "parent": 1896,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1930,
    "parent": 1928,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 1950,
    "parent": 1891,
    "notused": 189,
    "detail": "SCAN c VIRTUAL TABLE INDEX 0:version_id"
  },
  {
    "id": 1969,
    "parent": 1891,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 36"
  },
  {
    "id": 1973,
    "parent": 1969,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 1986,
    "parent": 1891,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 37"
  },
  {
    "id": 1990,
    "parent": 1986,
    "notused": 45,
    "detail": "SEARCH u USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 2020,
    "parent": 1891,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 2050,
    "parent": 1805,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2053,
    "parent": 2050,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 2058,
    "parent": 2053,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 2060,
    "parent": 2058,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 2089,
    "parent": 2053,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 2091,
    "parent": 2089,
    "notused": 216,
    "detail": "SCAN vir"
  },
  {
    "id": 2092,
    "parent": 2089,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 2118,
    "parent": 2050,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 2120,
    "parent": 2118,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2121,
    "parent": 2120,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 2125,
    "parent": 2121,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 2127,
    "parent": 2121,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 2152,
    "parent": 2120,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2154,
    "parent": 2152,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 2176,
    "parent": 2050,
    "notused": 189,
    "detail": "SCAN isc VIRTUAL TABLE INDEX 0:inheritance_delete_marker"
  },
  {
    "id": 2192,
    "parent": 2050,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 2204,
    "parent": 2050,
    "notused": 55,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 2213,
    "parent": 2050,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 39"
  },
  {
    "id": 2217,
    "parent": 2213,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 2231,
    "parent": 2050,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 40"
  },
  {
    "id": 2235,
    "parent": 2231,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 2258,
    "parent": 2050,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 41"
  },
  {
    "id": 2262,
    "parent": 2258,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 2293,
    "parent": 2050,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 2300,
    "parent": 2050,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2311,
    "parent": 2050,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2350,
    "parent": 1805,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2357,
    "parent": 2350,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 2361,
    "parent": 2350,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 2376,
    "parent": 2350,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 43"
  },
  {
    "id": 2380,
    "parent": 2376,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 2394,
    "parent": 2350,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 44"
  },
  {
    "id": 2398,
    "parent": 2394,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 2421,
    "parent": 2350,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 45"
  },
  {
    "id": 2425,
    "parent": 2421,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 2438,
    "parent": 2350,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2449,
    "parent": 2350,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2484,
    "parent": 1805,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2490,
    "parent": 2484,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 2504,
    "parent": 2484,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 2519,
    "parent": 2484,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 47"
  },
  {
    "id": 2523,
    "parent": 2519,
    "notused": 45,
    "detail": "SEARCH child_txn USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 2539,
    "parent": 2484,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 48"
  },
  {
    "id": 2543,
    "parent": 2539,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 2569,
    "parent": 2484,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 49"
  },
  {
    "id": 2573,
    "parent": 2569,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 2588,
    "parent": 2484,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2602,
    "parent": 2484,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2647,
    "parent": 1802,
    "notused": 0,
    "detail": "MATERIALIZE (subquery-23)"
  },
  {
    "id": 2649,
    "parent": 2647,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2650,
    "parent": 2649,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 2653,
    "parent": 2650,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 2678,
    "parent": 2649,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2681,
    "parent": 2678,
    "notused": 61,
    "detail": "SEARCH u USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 2695,
    "parent": 2678,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 7"
  },
  {
    "id": 2699,
    "parent": 2695,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 2731,
    "parent": 2649,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2734,
    "parent": 2731,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 2736,
    "parent": 2734,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2737,
    "parent": 2736,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 2741,
    "parent": 2737,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 2743,
    "parent": 2737,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 2768,
    "parent": 2736,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2770,
    "parent": 2768,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 2790,
    "parent": 2731,
    "notused": 189,
    "detail": "SCAN c VIRTUAL TABLE INDEX 0:version_id"
  },
  {
    "id": 2806,
    "parent": 2731,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 9"
  },
  {
    "id": 2810,
    "parent": 2806,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 2823,
    "parent": 2731,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 10"
  },
  {
    "id": 2827,
    "parent": 2823,
    "notused": 45,
    "detail": "SEARCH u USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 2857,
    "parent": 2731,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 2888,
    "parent": 2649,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2891,
    "parent": 2888,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 2896,
    "parent": 2891,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 2898,
    "parent": 2896,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 2927,
    "parent": 2891,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 2929,
    "parent": 2927,
    "notused": 216,
    "detail": "SCAN vir"
  },
  {
    "id": 2930,
    "parent": 2927,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 2956,
    "parent": 2888,
    "notused": 0,
    "detail": "MATERIALIZE change"
  },
  {
    "id": 2958,
    "parent": 2956,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2959,
    "parent": 2958,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 2963,
    "parent": 2959,
    "notused": 216,
    "detail": "SCAN c"
  },
  {
    "id": 2965,
    "parent": 2959,
    "notused": 47,
    "detail": "SEARCH s USING INDEX sqlite_autoindex_internal_snapshot_1 (id=?) LEFT-JOIN"
  },
  {
    "id": 2990,
    "parent": 2958,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2992,
    "parent": 2990,
    "notused": 216,
    "detail": "SCAN t"
  },
  {
    "id": 3014,
    "parent": 2888,
    "notused": 189,
    "detail": "SCAN isc VIRTUAL TABLE INDEX 0:inheritance_delete_marker"
  },
  {
    "id": 3027,
    "parent": 2888,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3039,
    "parent": 2888,
    "notused": 55,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3048,
    "parent": 2888,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 12"
  },
  {
    "id": 3052,
    "parent": 3048,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 3066,
    "parent": 2888,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 13"
  },
  {
    "id": 3070,
    "parent": 3066,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 3093,
    "parent": 2888,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 14"
  },
  {
    "id": 3097,
    "parent": 3093,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 3128,
    "parent": 2888,
    "notused": 53,
    "detail": "SEARCH ch USING AUTOMATIC COVERING INDEX (id=?) LEFT-JOIN"
  },
  {
    "id": 3135,
    "parent": 2888,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 3146,
    "parent": 2888,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 3186,
    "parent": 2649,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3193,
    "parent": 3186,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 3197,
    "parent": 3186,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 3209,
    "parent": 3186,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 16"
  },
  {
    "id": 3213,
    "parent": 3209,
    "notused": 45,
    "detail": "SEARCH t USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 3227,
    "parent": 3186,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 17"
  },
  {
    "id": 3231,
    "parent": 3227,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 3254,
    "parent": 3186,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 18"
  },
  {
    "id": 3258,
    "parent": 3254,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 3271,
    "parent": 3186,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 3282,
    "parent": 3186,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 3318,
    "parent": 2649,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3324,
    "parent": 3318,
    "notused": 99,
    "detail": "SCAN isc_v VIRTUAL TABLE INDEX 0:schema_key"
  },
  {
    "id": 3338,
    "parent": 3318,
    "notused": 62,
    "detail": "SEARCH txn USING INDEX ix_txn_v_f_s_e (version_id=?)"
  },
  {
    "id": 3350,
    "parent": 3318,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 20"
  },
  {
    "id": 3354,
    "parent": 3350,
    "notused": 45,
    "detail": "SEARCH child_txn USING COVERING INDEX sqlite_autoindex_internal_transaction_state_2 (entity_id=? AND file_id=? AND schema_key=? AND version_id=?)"
  },
  {
    "id": 3370,
    "parent": 3318,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 21"
  },
  {
    "id": 3374,
    "parent": 3370,
    "notused": 99,
    "detail": "SCAN child_isc VIRTUAL TABLE INDEX 0:version_id,file_id,schema_key,entity_id"
  },
  {
    "id": 3400,
    "parent": 3318,
    "notused": 0,
    "detail": "CORRELATED SCALAR SUBQUERY 22"
  },
  {
    "id": 3404,
    "parent": 3400,
    "notused": 45,
    "detail": "SEARCH child_unt USING COVERING INDEX sqlite_autoindex_internal_state_all_untracked_1 (entity_id=? AND schema_key=? AND file_id=? AND version_id=?)"
  },
  {
    "id": 3419,
    "parent": 3318,
    "notused": 45,
    "detail": "SEARCH ws_child USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 3433,
    "parent": 3318,
    "notused": 45,
    "detail": "SEARCH ws_parent USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 3477,
    "parent": 1802,
    "notused": 325,
    "detail": "SCAN (subquery-50)"
  },
  {
    "id": 3488,
    "parent": 1802,
    "notused": 0,
    "detail": "BLOOM FILTER ON (subquery-23) (version_id=? AND entity_id=? AND schema_key=? AND file_id=?)"
  },
  {
    "id": 3515,
    "parent": 1802,
    "notused": 56,
    "detail": "SEARCH (subquery-23) USING AUTOMATIC PARTIAL COVERING INDEX (version_id=? AND entity_id=? AND schema_key=? AND file_id=?) LEFT-JOIN"
  }
]