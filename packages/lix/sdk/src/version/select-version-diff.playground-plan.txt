-- original SQL --
select * from (
WITH
  -- Source side should expose explicit deletions (tombstones)
  -- Use state_with_tombstones to include rows with NULL snapshot_content
  s AS (
    SELECT entity_id, schema_key, file_id, change_id, commit_id, version_id, snapshot_content
    FROM state_with_tombstones
    WHERE version_id = 'test_0000000032'
  ),
  t AS (
    SELECT entity_id, schema_key, file_id, change_id, commit_id, version_id
    FROM state_all
    WHERE version_id = 'test_0000000062'
  ),
  joined AS (
    SELECT
      COALESCE(s.entity_id, t.entity_id) AS entity_id,
      COALESCE(s.schema_key, t.schema_key) AS schema_key,
      COALESCE(s.file_id, t.file_id) AS file_id,
      t.version_id AS before_version_id,
      t.change_id AS before_change_id,
      t.commit_id AS before_commit_id,
      s.version_id AS after_version_id,
      s.change_id AS after_change_id,
      s.commit_id AS after_commit_id,
      CASE
        -- Explicit delete in source (tombstone takes precedence)
        WHEN s.snapshot_content IS NULL THEN 'removed'
        -- Added in source only (live row)
        WHEN t.change_id IS NULL AND s.snapshot_content IS NOT NULL THEN 'added'
        -- Both present and different (live row in source)
        WHEN t.change_id IS NOT NULL AND s.snapshot_content IS NOT NULL AND s.change_id != t.change_id THEN 'modified'
        -- Both present and same (live row in source)
        ELSE 'unchanged'
      END AS status
    FROM s
    LEFT JOIN t ON t.entity_id = s.entity_id AND t.schema_key = s.schema_key AND t.file_id = s.file_id
    UNION ALL
    SELECT
      COALESCE(s.entity_id, t.entity_id) AS entity_id,
      COALESCE(s.schema_key, t.schema_key) AS schema_key,
      COALESCE(s.file_id, t.file_id) AS file_id,
      t.version_id AS before_version_id,
      t.change_id AS before_change_id,
      t.commit_id AS before_commit_id,
      -- For target-only rows (no source contribution), mirror target values for after_*
      -- This represents entities that exist in target but were never in source
      t.version_id AS after_version_id,
      t.change_id AS after_change_id,
      t.commit_id AS after_commit_id,
      CASE
        -- Target-only: entity exists in target but never existed in source (no explicit delete)
        -- Treated as unchanged since source doesn't modify it
        WHEN s.change_id IS NULL AND t.change_id IS NOT NULL THEN 'unchanged'
        ELSE 'unchanged'
      END AS status
    FROM t
    LEFT JOIN s ON s.entity_id = t.entity_id AND s.schema_key = t.schema_key AND s.file_id = t.file_id
    WHERE s.change_id IS NULL
  )
SELECT *
FROM joined
    ) as "diff" where "diff"."status" != ?

-- rewritten SQL --
SELECT *
FROM (WITH s AS (
  SELECT
    entity_id,
    schema_key,
    file_id,
    change_id,
    commit_id,
    version_id,
    snapshot_content
  FROM (SELECT
    entity_id,
    schema_key,
    file_id,
    version_id,
    plugin_key,
    snapshot_content,
    schema_version,
    created_at,
    updated_at,
    inherited_from_version_id,
    change_id,
    untracked,
    commit_id,
    writer_key,
    (SELECT json(metadata)
  FROM (SELECT
    c.id,
    c.entity_id,
    c.schema_key,
    c.schema_version,
    c.file_id,
    c.plugin_key,
    json(c.metadata) AS metadata,
    c.created_at,
    json(s.content) AS snapshot_content
  FROM lix_internal_change AS c LEFT JOIN lix_internal_snapshot AS s ON s.id = c.snapshot_id
  UNION ALL
  SELECT
    t.id,
    t.entity_id,
    t.schema_key,
    t.schema_version,
    t.file_id,
    t.plugin_key,
    json(t.metadata) AS metadata,
    t.created_at,
    json(t.snapshot_content) AS snapshot_content
  FROM lix_internal_transaction_state AS t
  WHERE t.untracked = 0) AS change
  WHERE change.id = lix_internal_state_vtable.change_id) AS metadata
  FROM (
  WITH
    version_descriptor_base AS (
      SELECT
        json_extract(desc.snapshot_content, '$.id') AS version_id,
        json_extract(desc.snapshot_content, '$.inherits_from_version_id') AS inherits_from_version_id
      FROM "lix_internal_state_cache_v1_lix_version_descriptor" desc
      WHERE desc.is_tombstone = 0
        AND desc.snapshot_content IS NOT NULL
    ),
    version_inheritance(version_id, ancestor_version_id) AS (
      SELECT
        vdb.version_id,
        vdb.inherits_from_version_id
      FROM version_descriptor_base vdb
      WHERE vdb.inherits_from_version_id IS NOT NULL

      UNION ALL

      SELECT
        vi.version_id,
        vdb.inherits_from_version_id
      FROM version_inheritance vi
      JOIN version_descriptor_base vdb ON vdb.version_id = vi.ancestor_version_id
      WHERE vdb.inherits_from_version_id IS NOT NULL
    ),
    version_parent AS (
      SELECT
        vdb.version_id,
        vdb.inherits_from_version_id AS parent_version_id
      FROM version_descriptor_base vdb
      WHERE vdb.inherits_from_version_id IS NOT NULL
    ),
    candidates AS (
       SELECT
         unt.entity_id AS entity_id,
         unt.schema_key AS schema_key,
         unt.file_id AS file_id,
         unt.plugin_key AS plugin_key,
         json(unt.snapshot_content) AS snapshot_content,
         unt.schema_version AS schema_version,
         unt.version_id AS version_id,
         unt.created_at AS created_at,
         unt.updated_at AS updated_at,
         NULL AS inherited_from_version_id,
         'untracked' AS change_id,
         1 AS untracked,
         'untracked' AS commit_id,
         NULL AS metadata,
         NULL AS writer_key,
         2 AS priority
       FROM lix_internal_state_all_untracked unt

           UNION ALL

       		SELECT
           cache.entity_id AS entity_id,
           cache.schema_key AS schema_key,
           cache.file_id AS file_id,
           cache.plugin_key AS plugin_key,
           json(cache.snapshot_content) AS snapshot_content,
           cache.schema_version AS schema_version,
           cache.version_id AS version_id,
           cache.created_at AS created_at,
           cache.updated_at AS updated_at,
           cache.inherited_from_version_id AS inherited_from_version_id,
           cache.change_id AS change_id,
           0 AS untracked,
           cache.commit_id AS commit_id,
           NULL AS metadata,
           NULL AS writer_key,
           3 AS priority
       		FROM (SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_descriptor"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_stored_schema"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit_edge"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_tip"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set_element"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_label"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_key_value"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_active_account"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_test_bench_diff_entity") cache

           UNION ALL

       		SELECT
           cache.entity_id AS entity_id,
           cache.schema_key AS schema_key,
           cache.file_id AS file_id,
           cache.plugin_key AS plugin_key,
           json(cache.snapshot_content) AS snapshot_content,
           cache.schema_version AS schema_version,
           vi.version_id AS version_id,
           cache.created_at AS created_at,
           cache.updated_at AS updated_at,
           cache.version_id AS inherited_from_version_id,
           cache.change_id AS change_id,
           0 AS untracked,
           cache.commit_id AS commit_id,
           NULL AS metadata,
           NULL AS writer_key,
           4 AS priority
       		FROM version_inheritance vi
       		JOIN (SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_descriptor"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_stored_schema"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit_edge"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_tip"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set_element"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_label"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_key_value"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_active_account"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_test_bench_diff_entity") cache ON cache.version_id = vi.ancestor_version_id
       		WHERE cache.is_tombstone = 0
       		  AND cache.snapshot_content IS NOT NULL

           UNION ALL

       SELECT
         unt.entity_id AS entity_id,
         unt.schema_key AS schema_key,
         unt.file_id AS file_id,
         unt.plugin_key AS plugin_key,
         json(unt.snapshot_content) AS snapshot_content,
         unt.schema_version AS schema_version,
         vi.version_id AS version_id,
         unt.created_at AS created_at,
         unt.updated_at AS updated_at,
         unt.version_id AS inherited_from_version_id,
         'untracked' AS change_id,
         1 AS untracked,
         'untracked' AS commit_id,
         NULL AS metadata,
         NULL AS writer_key,
         5 AS priority
       FROM version_inheritance vi
       JOIN lix_internal_state_all_untracked unt ON unt.version_id = vi.ancestor_version_id
       WHERE unt.is_tombstone = 0
         AND unt.snapshot_content IS NOT NULL
    ),
    ranked AS (
       SELECT
         c.entity_id AS entity_id,
         c.schema_key AS schema_key,
         c.file_id AS file_id,
         c.plugin_key AS plugin_key,
         c.snapshot_content AS snapshot_content,
         c.schema_version AS schema_version,
         c.version_id AS version_id,
         c.created_at AS created_at,
         c.updated_at AS updated_at,
         c.inherited_from_version_id AS inherited_from_version_id,
         c.change_id AS change_id,
         c.untracked AS untracked,
         c.commit_id AS commit_id,
         c.metadata AS metadata,
         c.writer_key AS writer_key,
         c.priority AS priority,
       ROW_NUMBER() OVER (
           PARTITION BY c.file_id, c.schema_key, c.entity_id, c.version_id
           ORDER BY c.priority, c.created_at DESC, c.file_id, c.schema_key, c.entity_id, c.version_id, c.change_id
         ) AS rn
       FROM candidates c
    )
  SELECT
    w."entity_id" AS "entity_id",
    w."schema_key" AS "schema_key",
    w."file_id" AS "file_id",
    w."plugin_key" AS "plugin_key",
    w."snapshot_content" AS "snapshot_content",
    w."schema_version" AS "schema_version",
    w."version_id" AS "version_id",
    w."created_at" AS "created_at",
    w."updated_at" AS "updated_at",
    w."inherited_from_version_id" AS "inherited_from_version_id",
    w."change_id" AS "change_id",
    w."untracked" AS "untracked",
    w."commit_id" AS "commit_id",
    w."metadata" AS "metadata",
    COALESCE(ws_dst.writer_key, ws_src.writer_key, w.writer_key) AS "writer_key"
  FROM ranked w

  LEFT JOIN lix_internal_state_writer ws_dst ON
    ws_dst.file_id = w.file_id AND
    ws_dst.entity_id = w.entity_id AND
    ws_dst.schema_key = w.schema_key AND
    ws_dst.version_id = w.version_id
  LEFT JOIN lix_internal_state_writer ws_src ON
    ws_src.file_id = w.file_id AND
    ws_src.entity_id = w.entity_id AND
    ws_src.schema_key = w.schema_key AND
    ws_src.version_id = w.inherited_from_version_id

  LEFT JOIN lix_internal_change chc ON chc.id = w.change_id

  WHERE w.rn = 1
  ) AS "lix_internal_state_vtable") AS state_with_tombstones
  WHERE version_id = 'test_0000000032'
),
t AS (
  SELECT
    entity_id,
    schema_key,
    file_id,
    change_id,
    commit_id,
    version_id
  FROM (SELECT
    entity_id,
    schema_key,
    file_id,
    version_id,
    plugin_key,
    snapshot_content,
    schema_version,
    created_at,
    updated_at,
    inherited_from_version_id,
    change_id,
    untracked,
    commit_id,
    writer_key,
    (SELECT json(metadata)
  FROM (SELECT
    c.id,
    c.entity_id,
    c.schema_key,
    c.schema_version,
    c.file_id,
    c.plugin_key,
    json(c.metadata) AS metadata,
    c.created_at,
    json(s.content) AS snapshot_content
  FROM lix_internal_change AS c LEFT JOIN lix_internal_snapshot AS s ON s.id = c.snapshot_id
  UNION ALL
  SELECT
    t.id,
    t.entity_id,
    t.schema_key,
    t.schema_version,
    t.file_id,
    t.plugin_key,
    json(t.metadata) AS metadata,
    t.created_at,
    json(t.snapshot_content) AS snapshot_content
  FROM lix_internal_transaction_state AS t
  WHERE t.untracked = 0) AS change
  WHERE change.id = lix_internal_state_vtable.change_id) AS metadata
  FROM (
  WITH
    version_descriptor_base AS (
      SELECT
        json_extract(desc.snapshot_content, '$.id') AS version_id,
        json_extract(desc.snapshot_content, '$.inherits_from_version_id') AS inherits_from_version_id
      FROM "lix_internal_state_cache_v1_lix_version_descriptor" desc
      WHERE desc.is_tombstone = 0
        AND desc.snapshot_content IS NOT NULL
    ),
    version_inheritance(version_id, ancestor_version_id) AS (
      SELECT
        vdb.version_id,
        vdb.inherits_from_version_id
      FROM version_descriptor_base vdb
      WHERE vdb.inherits_from_version_id IS NOT NULL

      UNION ALL

      SELECT
        vi.version_id,
        vdb.inherits_from_version_id
      FROM version_inheritance vi
      JOIN version_descriptor_base vdb ON vdb.version_id = vi.ancestor_version_id
      WHERE vdb.inherits_from_version_id IS NOT NULL
    ),
    version_parent AS (
      SELECT
        vdb.version_id,
        vdb.inherits_from_version_id AS parent_version_id
      FROM version_descriptor_base vdb
      WHERE vdb.inherits_from_version_id IS NOT NULL
    ),
    candidates AS (
       SELECT
         unt.entity_id AS entity_id,
         unt.schema_key AS schema_key,
         unt.file_id AS file_id,
         unt.plugin_key AS plugin_key,
         json(unt.snapshot_content) AS snapshot_content,
         unt.schema_version AS schema_version,
         unt.version_id AS version_id,
         unt.created_at AS created_at,
         unt.updated_at AS updated_at,
         NULL AS inherited_from_version_id,
         'untracked' AS change_id,
         1 AS untracked,
         'untracked' AS commit_id,
         NULL AS metadata,
         NULL AS writer_key,
         2 AS priority
       FROM lix_internal_state_all_untracked unt

           UNION ALL

       		SELECT
           cache.entity_id AS entity_id,
           cache.schema_key AS schema_key,
           cache.file_id AS file_id,
           cache.plugin_key AS plugin_key,
           json(cache.snapshot_content) AS snapshot_content,
           cache.schema_version AS schema_version,
           cache.version_id AS version_id,
           cache.created_at AS created_at,
           cache.updated_at AS updated_at,
           cache.inherited_from_version_id AS inherited_from_version_id,
           cache.change_id AS change_id,
           0 AS untracked,
           cache.commit_id AS commit_id,
           NULL AS metadata,
           NULL AS writer_key,
           3 AS priority
       		FROM (SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_descriptor"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_stored_schema"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit_edge"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_tip"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set_element"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_label"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_key_value"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_active_account"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_test_bench_diff_entity") cache

           UNION ALL

       		SELECT
           cache.entity_id AS entity_id,
           cache.schema_key AS schema_key,
           cache.file_id AS file_id,
           cache.plugin_key AS plugin_key,
           json(cache.snapshot_content) AS snapshot_content,
           cache.schema_version AS schema_version,
           vi.version_id AS version_id,
           cache.created_at AS created_at,
           cache.updated_at AS updated_at,
           cache.version_id AS inherited_from_version_id,
           cache.change_id AS change_id,
           0 AS untracked,
           cache.commit_id AS commit_id,
           NULL AS metadata,
           NULL AS writer_key,
           4 AS priority
       		FROM version_inheritance vi
       		JOIN (SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_descriptor"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_stored_schema"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_commit_edge"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_version_tip"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_change_set_element"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_label"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_key_value"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_lix_active_account"
       UNION ALL
       SELECT
           "entity_id",
           "schema_key",
           "file_id",
           "plugin_key",
           "snapshot_content",
           "schema_version",
           "version_id",
           "created_at",
           "updated_at",
           "inherited_from_version_id",
           "change_id",
           "commit_id",
           "is_tombstone"
         FROM "lix_internal_state_cache_v1_test_bench_diff_entity") cache ON cache.version_id = vi.ancestor_version_id
       		WHERE cache.is_tombstone = 0
       		  AND cache.snapshot_content IS NOT NULL

           UNION ALL

       SELECT
         unt.entity_id AS entity_id,
         unt.schema_key AS schema_key,
         unt.file_id AS file_id,
         unt.plugin_key AS plugin_key,
         json(unt.snapshot_content) AS snapshot_content,
         unt.schema_version AS schema_version,
         vi.version_id AS version_id,
         unt.created_at AS created_at,
         unt.updated_at AS updated_at,
         unt.version_id AS inherited_from_version_id,
         'untracked' AS change_id,
         1 AS untracked,
         'untracked' AS commit_id,
         NULL AS metadata,
         NULL AS writer_key,
         5 AS priority
       FROM version_inheritance vi
       JOIN lix_internal_state_all_untracked unt ON unt.version_id = vi.ancestor_version_id
       WHERE unt.is_tombstone = 0
         AND unt.snapshot_content IS NOT NULL
    ),
    ranked AS (
       SELECT
         c.entity_id AS entity_id,
         c.schema_key AS schema_key,
         c.file_id AS file_id,
         c.plugin_key AS plugin_key,
         c.snapshot_content AS snapshot_content,
         c.schema_version AS schema_version,
         c.version_id AS version_id,
         c.created_at AS created_at,
         c.updated_at AS updated_at,
         c.inherited_from_version_id AS inherited_from_version_id,
         c.change_id AS change_id,
         c.untracked AS untracked,
         c.commit_id AS commit_id,
         c.metadata AS metadata,
         c.writer_key AS writer_key,
         c.priority AS priority,
       ROW_NUMBER() OVER (
           PARTITION BY c.file_id, c.schema_key, c.entity_id, c.version_id
           ORDER BY c.priority, c.created_at DESC, c.file_id, c.schema_key, c.entity_id, c.version_id, c.change_id
         ) AS rn
       FROM candidates c
    )
  SELECT
    w."entity_id" AS "entity_id",
    w."schema_key" AS "schema_key",
    w."file_id" AS "file_id",
    w."plugin_key" AS "plugin_key",
    w."snapshot_content" AS "snapshot_content",
    w."schema_version" AS "schema_version",
    w."version_id" AS "version_id",
    w."created_at" AS "created_at",
    w."updated_at" AS "updated_at",
    w."inherited_from_version_id" AS "inherited_from_version_id",
    w."change_id" AS "change_id",
    w."untracked" AS "untracked",
    w."commit_id" AS "commit_id",
    w."metadata" AS "metadata",
    COALESCE(ws_dst.writer_key, ws_src.writer_key, w.writer_key) AS "writer_key"
  FROM ranked w

  LEFT JOIN lix_internal_state_writer ws_dst ON
    ws_dst.file_id = w.file_id AND
    ws_dst.entity_id = w.entity_id AND
    ws_dst.schema_key = w.schema_key AND
    ws_dst.version_id = w.version_id
  LEFT JOIN lix_internal_state_writer ws_src ON
    ws_src.file_id = w.file_id AND
    ws_src.entity_id = w.entity_id AND
    ws_src.schema_key = w.schema_key AND
    ws_src.version_id = w.inherited_from_version_id

  LEFT JOIN lix_internal_change chc ON chc.id = w.change_id

  WHERE w.rn = 1
  ) AS "lix_internal_state_vtable"
  WHERE snapshot_content IS NOT NULL) AS state_all
  WHERE version_id = 'test_0000000062'
),
joined AS (
  SELECT
    COALESCE(s.entity_id, t.entity_id) AS entity_id,
    COALESCE(s.schema_key, t.schema_key) AS schema_key,
    COALESCE(s.file_id, t.file_id) AS file_id,
    t.version_id AS before_version_id,
    t.change_id AS before_change_id,
    t.commit_id AS before_commit_id,
    s.version_id AS after_version_id,
    s.change_id AS after_change_id,
    s.commit_id AS after_commit_id,
    CASE WHEN s.snapshot_content IS NULL THEN 'removed' WHEN t.change_id IS NULL AND s.snapshot_content IS NOT NULL THEN 'added' WHEN t.change_id IS NOT NULL AND s.snapshot_content IS NOT NULL AND s.change_id != t.change_id THEN 'modified' ELSE 'unchanged' END AS status
  FROM s LEFT JOIN t ON t.entity_id = s.entity_id AND t.schema_key = s.schema_key AND t.file_id = s.file_id
  UNION ALL
  SELECT
    COALESCE(s.entity_id, t.entity_id) AS entity_id,
    COALESCE(s.schema_key, t.schema_key) AS schema_key,
    COALESCE(s.file_id, t.file_id) AS file_id,
    t.version_id AS before_version_id,
    t.change_id AS before_change_id,
    t.commit_id AS before_commit_id,
    t.version_id AS after_version_id,
    t.change_id AS after_change_id,
    t.commit_id AS after_commit_id,
    CASE WHEN s.change_id IS NULL AND t.change_id IS NOT NULL THEN 'unchanged' ELSE 'unchanged' END AS status
  FROM t LEFT JOIN s ON s.entity_id = t.entity_id AND s.schema_key = t.schema_key AND s.file_id = t.file_id
  WHERE s.change_id IS NULL
)
SELECT *
FROM joined) AS "diff"
WHERE "diff"."status" != ?

-- plan --
[
  {
    "id": 1,
    "parent": 0,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2,
    "parent": 1,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 4,
    "parent": 2,
    "notused": 0,
    "detail": "CO-ROUTINE ranked"
  },
  {
    "id": 7,
    "parent": 4,
    "notused": 0,
    "detail": "CO-ROUTINE (subquery-80)"
  },
  {
    "id": 9,
    "parent": 7,
    "notused": 0,
    "detail": "CO-ROUTINE candidates"
  },
  {
    "id": 10,
    "parent": 9,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 11,
    "parent": 10,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 14,
    "parent": 11,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 38,
    "parent": 10,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 39,
    "parent": 38,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 40,
    "parent": 39,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 43,
    "parent": 40,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_descriptor USING INDEX idx_lix_internal_state_cache_v1_lix_version_descriptor_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 70,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 73,
    "parent": 70,
    "notused": 59,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_stored_schema USING INDEX idx_lix_internal_state_cache_v1_lix_stored_schema_pk_version_id_json_extract_snapsho_json_extract_snapsho_r7zrf9 (version_id=?)"
  },
  {
    "id": 100,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 103,
    "parent": 100,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit USING INDEX idx_lix_internal_state_cache_v1_lix_commit_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 130,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 133,
    "parent": 130,
    "notused": 48,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit_edge USING INDEX idx_lix_internal_state_cache_v1_lix_commit_edge_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 160,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 163,
    "parent": 160,
    "notused": 36,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_tip USING INDEX idx_lix_internal_state_cache_v1_lix_version_tip_unique_version_id_json_extract_snapsho_c3jqlx (version_id=?)"
  },
  {
    "id": 190,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 193,
    "parent": 190,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 220,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 223,
    "parent": 220,
    "notused": 72,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set_element USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_element_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 250,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 253,
    "parent": 250,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 280,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 283,
    "parent": 280,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_key_value USING INDEX idx_lix_internal_state_cache_v1_lix_key_value_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 310,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 313,
    "parent": 310,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 340,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 343,
    "parent": 340,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_test_bench_diff_entity USING INDEX idx_lix_internal_state_cache_v1_test_bench_diff_entity_vfe (version_id=?)"
  },
  {
    "id": 370,
    "parent": 39,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 371,
    "parent": 370,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 372,
    "parent": 371,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 375,
    "parent": 372,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 379,
    "parent": 375,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 381,
    "parent": 379,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 409,
    "parent": 375,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 411,
    "parent": 409,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 420,
    "parent": 409,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 436,
    "parent": 372,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_descriptor"
  },
  {
    "id": 446,
    "parent": 372,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 458,
    "parent": 372,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 486,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 490,
    "parent": 486,
    "notused": 59,
    "detail": "SCAN lix_internal_state_cache_v1_lix_stored_schema"
  },
  {
    "id": 498,
    "parent": 486,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 510,
    "parent": 486,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 538,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 542,
    "parent": 538,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit"
  },
  {
    "id": 550,
    "parent": 538,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 562,
    "parent": 538,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 590,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 594,
    "parent": 590,
    "notused": 48,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit_edge"
  },
  {
    "id": 602,
    "parent": 590,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 614,
    "parent": 590,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 642,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 646,
    "parent": 642,
    "notused": 36,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_tip"
  },
  {
    "id": 654,
    "parent": 642,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 666,
    "parent": 642,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 694,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 698,
    "parent": 694,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set"
  },
  {
    "id": 706,
    "parent": 694,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 718,
    "parent": 694,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 746,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 750,
    "parent": 746,
    "notused": 72,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set_element"
  },
  {
    "id": 758,
    "parent": 746,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 770,
    "parent": 746,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 798,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 803,
    "parent": 798,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_live_vfe"
  },
  {
    "id": 811,
    "parent": 798,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 823,
    "parent": 798,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 851,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 855,
    "parent": 851,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_key_value"
  },
  {
    "id": 863,
    "parent": 851,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 875,
    "parent": 851,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 903,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 908,
    "parent": 903,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_live_vfe"
  },
  {
    "id": 916,
    "parent": 903,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 928,
    "parent": 903,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 956,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 960,
    "parent": 956,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_test_bench_diff_entity"
  },
  {
    "id": 968,
    "parent": 956,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 980,
    "parent": 956,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1008,
    "parent": 371,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1013,
    "parent": 1008,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 1017,
    "parent": 1008,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 1050,
    "parent": 39,
    "notused": 227,
    "detail": "SCAN c"
  },
  {
    "id": 1089,
    "parent": 39,
    "notused": 0,
    "detail": "USE TEMP B-TREE FOR ORDER BY"
  },
  {
    "id": 1129,
    "parent": 38,
    "notused": 207,
    "detail": "SCAN (subquery-80)"
  },
  {
    "id": 1213,
    "parent": 10,
    "notused": 0,
    "detail": "MATERIALIZE lix_internal_state_vtable"
  },
  {
    "id": 1215,
    "parent": 1213,
    "notused": 0,
    "detail": "CO-ROUTINE ranked"
  },
  {
    "id": 1218,
    "parent": 1215,
    "notused": 0,
    "detail": "CO-ROUTINE (subquery-101)"
  },
  {
    "id": 1220,
    "parent": 1218,
    "notused": 0,
    "detail": "CO-ROUTINE candidates"
  },
  {
    "id": 1221,
    "parent": 1220,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 1222,
    "parent": 1221,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 1225,
    "parent": 1222,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 1249,
    "parent": 1221,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1250,
    "parent": 1249,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 1251,
    "parent": 1250,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 1254,
    "parent": 1251,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_descriptor USING INDEX idx_lix_internal_state_cache_v1_lix_version_descriptor_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 1281,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1284,
    "parent": 1281,
    "notused": 59,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_stored_schema USING INDEX idx_lix_internal_state_cache_v1_lix_stored_schema_pk_version_id_json_extract_snapsho_json_extract_snapsho_r7zrf9 (version_id=?)"
  },
  {
    "id": 1311,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1314,
    "parent": 1311,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit USING INDEX idx_lix_internal_state_cache_v1_lix_commit_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 1341,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1344,
    "parent": 1341,
    "notused": 48,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit_edge USING INDEX idx_lix_internal_state_cache_v1_lix_commit_edge_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 1371,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1374,
    "parent": 1371,
    "notused": 36,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_tip USING INDEX idx_lix_internal_state_cache_v1_lix_version_tip_unique_version_id_json_extract_snapsho_c3jqlx (version_id=?)"
  },
  {
    "id": 1401,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1404,
    "parent": 1401,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 1431,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1434,
    "parent": 1431,
    "notused": 72,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set_element USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_element_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 1461,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1464,
    "parent": 1461,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 1491,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1494,
    "parent": 1491,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_key_value USING INDEX idx_lix_internal_state_cache_v1_lix_key_value_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 1521,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1524,
    "parent": 1521,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 1551,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1554,
    "parent": 1551,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_test_bench_diff_entity USING INDEX idx_lix_internal_state_cache_v1_test_bench_diff_entity_vfe (version_id=?)"
  },
  {
    "id": 1581,
    "parent": 1250,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1582,
    "parent": 1581,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 1583,
    "parent": 1582,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 1586,
    "parent": 1583,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 1590,
    "parent": 1586,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 1592,
    "parent": 1590,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 1620,
    "parent": 1586,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 1622,
    "parent": 1620,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 1631,
    "parent": 1620,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 1647,
    "parent": 1583,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_descriptor"
  },
  {
    "id": 1657,
    "parent": 1583,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1669,
    "parent": 1583,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1697,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1701,
    "parent": 1697,
    "notused": 59,
    "detail": "SCAN lix_internal_state_cache_v1_lix_stored_schema"
  },
  {
    "id": 1709,
    "parent": 1697,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1721,
    "parent": 1697,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1749,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1753,
    "parent": 1749,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit"
  },
  {
    "id": 1761,
    "parent": 1749,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1773,
    "parent": 1749,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1801,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1805,
    "parent": 1801,
    "notused": 48,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit_edge"
  },
  {
    "id": 1813,
    "parent": 1801,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1825,
    "parent": 1801,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1853,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1857,
    "parent": 1853,
    "notused": 36,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_tip"
  },
  {
    "id": 1865,
    "parent": 1853,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1877,
    "parent": 1853,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1905,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1909,
    "parent": 1905,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set"
  },
  {
    "id": 1917,
    "parent": 1905,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1929,
    "parent": 1905,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 1957,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 1961,
    "parent": 1957,
    "notused": 72,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set_element"
  },
  {
    "id": 1969,
    "parent": 1957,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 1981,
    "parent": 1957,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 2009,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2014,
    "parent": 2009,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_live_vfe"
  },
  {
    "id": 2022,
    "parent": 2009,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 2034,
    "parent": 2009,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 2062,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2066,
    "parent": 2062,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_key_value"
  },
  {
    "id": 2074,
    "parent": 2062,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 2086,
    "parent": 2062,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 2114,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2119,
    "parent": 2114,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_live_vfe"
  },
  {
    "id": 2127,
    "parent": 2114,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 2139,
    "parent": 2114,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 2167,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2171,
    "parent": 2167,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_test_bench_diff_entity"
  },
  {
    "id": 2179,
    "parent": 2167,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 2191,
    "parent": 2167,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 2219,
    "parent": 1582,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2224,
    "parent": 2219,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 2228,
    "parent": 2219,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 2261,
    "parent": 1250,
    "notused": 227,
    "detail": "SCAN c"
  },
  {
    "id": 2300,
    "parent": 1250,
    "notused": 0,
    "detail": "USE TEMP B-TREE FOR ORDER BY"
  },
  {
    "id": 2340,
    "parent": 1249,
    "notused": 207,
    "detail": "SCAN (subquery-101)"
  },
  {
    "id": 2425,
    "parent": 1221,
    "notused": 207,
    "detail": "SCAN w"
  },
  {
    "id": 2434,
    "parent": 1221,
    "notused": 45,
    "detail": "SEARCH ws_dst USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2447,
    "parent": 1221,
    "notused": 45,
    "detail": "SEARCH ws_src USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 2486,
    "parent": 1220,
    "notused": 207,
    "detail": "SCAN w"
  },
  {
    "id": 2497,
    "parent": 1220,
    "notused": 0,
    "detail": "BLOOM FILTER ON lix_internal_state_vtable (version_id=? AND entity_id=? AND schema_key=? AND file_id=?)"
  },
  {
    "id": 2525,
    "parent": 1220,
    "notused": 52,
    "detail": "SEARCH lix_internal_state_vtable USING AUTOMATIC PARTIAL COVERING INDEX (version_id=? AND entity_id=? AND schema_key=? AND file_id=?) LEFT-JOIN"
  },
  {
    "id": 2606,
    "parent": 1218,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2608,
    "parent": 2606,
    "notused": 0,
    "detail": "CO-ROUTINE ranked"
  },
  {
    "id": 2611,
    "parent": 2608,
    "notused": 0,
    "detail": "CO-ROUTINE (subquery-122)"
  },
  {
    "id": 2613,
    "parent": 2611,
    "notused": 0,
    "detail": "CO-ROUTINE candidates"
  },
  {
    "id": 2614,
    "parent": 2613,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2615,
    "parent": 2614,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 2618,
    "parent": 2615,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 2642,
    "parent": 2614,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2643,
    "parent": 2642,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2644,
    "parent": 2643,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 2647,
    "parent": 2644,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_descriptor USING INDEX idx_lix_internal_state_cache_v1_lix_version_descriptor_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 2674,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2677,
    "parent": 2674,
    "notused": 59,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_stored_schema USING INDEX idx_lix_internal_state_cache_v1_lix_stored_schema_pk_version_id_json_extract_snapsho_json_extract_snapsho_r7zrf9 (version_id=?)"
  },
  {
    "id": 2704,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2707,
    "parent": 2704,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit USING INDEX idx_lix_internal_state_cache_v1_lix_commit_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 2734,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2737,
    "parent": 2734,
    "notused": 48,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit_edge USING INDEX idx_lix_internal_state_cache_v1_lix_commit_edge_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 2764,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2767,
    "parent": 2764,
    "notused": 36,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_tip USING INDEX idx_lix_internal_state_cache_v1_lix_version_tip_unique_version_id_json_extract_snapsho_c3jqlx (version_id=?)"
  },
  {
    "id": 2794,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2797,
    "parent": 2794,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 2824,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2827,
    "parent": 2824,
    "notused": 72,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set_element USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_element_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 2854,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2857,
    "parent": 2854,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 2884,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2887,
    "parent": 2884,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_key_value USING INDEX idx_lix_internal_state_cache_v1_lix_key_value_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 2914,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2917,
    "parent": 2914,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 2944,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2947,
    "parent": 2944,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_test_bench_diff_entity USING INDEX idx_lix_internal_state_cache_v1_test_bench_diff_entity_vfe (version_id=?)"
  },
  {
    "id": 2974,
    "parent": 2643,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 2975,
    "parent": 2974,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 2976,
    "parent": 2975,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 2979,
    "parent": 2976,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 2983,
    "parent": 2979,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 2985,
    "parent": 2983,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 3013,
    "parent": 2979,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 3015,
    "parent": 3013,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 3024,
    "parent": 3013,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 3040,
    "parent": 2976,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_descriptor"
  },
  {
    "id": 3050,
    "parent": 2976,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3062,
    "parent": 2976,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3090,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3094,
    "parent": 3090,
    "notused": 59,
    "detail": "SCAN lix_internal_state_cache_v1_lix_stored_schema"
  },
  {
    "id": 3102,
    "parent": 3090,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3114,
    "parent": 3090,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3142,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3146,
    "parent": 3142,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit"
  },
  {
    "id": 3154,
    "parent": 3142,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3166,
    "parent": 3142,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3194,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3198,
    "parent": 3194,
    "notused": 48,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit_edge"
  },
  {
    "id": 3206,
    "parent": 3194,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3218,
    "parent": 3194,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3246,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3250,
    "parent": 3246,
    "notused": 36,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_tip"
  },
  {
    "id": 3258,
    "parent": 3246,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3270,
    "parent": 3246,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3298,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3302,
    "parent": 3298,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set"
  },
  {
    "id": 3310,
    "parent": 3298,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3322,
    "parent": 3298,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3350,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3354,
    "parent": 3350,
    "notused": 72,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set_element"
  },
  {
    "id": 3362,
    "parent": 3350,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3374,
    "parent": 3350,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3402,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3407,
    "parent": 3402,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_live_vfe"
  },
  {
    "id": 3415,
    "parent": 3402,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3427,
    "parent": 3402,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3455,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3459,
    "parent": 3455,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_key_value"
  },
  {
    "id": 3467,
    "parent": 3455,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3479,
    "parent": 3455,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3507,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3512,
    "parent": 3507,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_live_vfe"
  },
  {
    "id": 3520,
    "parent": 3507,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3532,
    "parent": 3507,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3560,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3564,
    "parent": 3560,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_test_bench_diff_entity"
  },
  {
    "id": 3572,
    "parent": 3560,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 3584,
    "parent": 3560,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 3612,
    "parent": 2975,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3617,
    "parent": 3612,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 3621,
    "parent": 3612,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 3654,
    "parent": 2643,
    "notused": 227,
    "detail": "SCAN c"
  },
  {
    "id": 3693,
    "parent": 2643,
    "notused": 0,
    "detail": "USE TEMP B-TREE FOR ORDER BY"
  },
  {
    "id": 3733,
    "parent": 2642,
    "notused": 207,
    "detail": "SCAN (subquery-122)"
  },
  {
    "id": 3817,
    "parent": 2614,
    "notused": 0,
    "detail": "MATERIALIZE lix_internal_state_vtable"
  },
  {
    "id": 3819,
    "parent": 3817,
    "notused": 0,
    "detail": "CO-ROUTINE ranked"
  },
  {
    "id": 3822,
    "parent": 3819,
    "notused": 0,
    "detail": "CO-ROUTINE (subquery-143)"
  },
  {
    "id": 3824,
    "parent": 3822,
    "notused": 0,
    "detail": "CO-ROUTINE candidates"
  },
  {
    "id": 3825,
    "parent": 3824,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 3826,
    "parent": 3825,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 3829,
    "parent": 3826,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 3853,
    "parent": 3825,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3854,
    "parent": 3853,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 3855,
    "parent": 3854,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 3858,
    "parent": 3855,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_descriptor USING INDEX idx_lix_internal_state_cache_v1_lix_version_descriptor_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 3885,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3888,
    "parent": 3885,
    "notused": 59,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_stored_schema USING INDEX idx_lix_internal_state_cache_v1_lix_stored_schema_pk_version_id_json_extract_snapsho_json_extract_snapsho_r7zrf9 (version_id=?)"
  },
  {
    "id": 3915,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3918,
    "parent": 3915,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit USING INDEX idx_lix_internal_state_cache_v1_lix_commit_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 3945,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3948,
    "parent": 3945,
    "notused": 48,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_commit_edge USING INDEX idx_lix_internal_state_cache_v1_lix_commit_edge_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 3975,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 3978,
    "parent": 3975,
    "notused": 36,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_version_tip USING INDEX idx_lix_internal_state_cache_v1_lix_version_tip_unique_version_id_json_extract_snapsho_c3jqlx (version_id=?)"
  },
  {
    "id": 4005,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4008,
    "parent": 4005,
    "notused": 53,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 4035,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4038,
    "parent": 4035,
    "notused": 72,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_change_set_element USING INDEX idx_lix_internal_state_cache_v1_lix_change_set_element_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 4065,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4068,
    "parent": 4065,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 4095,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4098,
    "parent": 4095,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_key_value USING INDEX idx_lix_internal_state_cache_v1_lix_key_value_pk_version_id_json_extract_snapsho_4h2kdb (version_id=?)"
  },
  {
    "id": 4125,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4128,
    "parent": 4125,
    "notused": 62,
    "detail": "SEARCH lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_foreign_version_id_inherited_from_versi_json_extract_snapsho_79rox8 (version_id=?)"
  },
  {
    "id": 4155,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4158,
    "parent": 4155,
    "notused": 32,
    "detail": "SEARCH lix_internal_state_cache_v1_test_bench_diff_entity USING INDEX idx_lix_internal_state_cache_v1_test_bench_diff_entity_vfe (version_id=?)"
  },
  {
    "id": 4185,
    "parent": 3854,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4186,
    "parent": 4185,
    "notused": 0,
    "detail": "COMPOUND QUERY"
  },
  {
    "id": 4187,
    "parent": 4186,
    "notused": 0,
    "detail": "LEFT-MOST SUBQUERY"
  },
  {
    "id": 4190,
    "parent": 4187,
    "notused": 0,
    "detail": "MATERIALIZE version_inheritance"
  },
  {
    "id": 4194,
    "parent": 4190,
    "notused": 0,
    "detail": "SETUP"
  },
  {
    "id": 4196,
    "parent": 4194,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 4224,
    "parent": 4190,
    "notused": 0,
    "detail": "RECURSIVE STEP"
  },
  {
    "id": 4226,
    "parent": 4224,
    "notused": 32,
    "detail": "SCAN desc"
  },
  {
    "id": 4235,
    "parent": 4224,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 4251,
    "parent": 4187,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_descriptor"
  },
  {
    "id": 4261,
    "parent": 4187,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4273,
    "parent": 4187,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4301,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4305,
    "parent": 4301,
    "notused": 59,
    "detail": "SCAN lix_internal_state_cache_v1_lix_stored_schema"
  },
  {
    "id": 4313,
    "parent": 4301,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4325,
    "parent": 4301,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4353,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4357,
    "parent": 4353,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit"
  },
  {
    "id": 4365,
    "parent": 4353,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4377,
    "parent": 4353,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4405,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4409,
    "parent": 4405,
    "notused": 48,
    "detail": "SCAN lix_internal_state_cache_v1_lix_commit_edge"
  },
  {
    "id": 4417,
    "parent": 4405,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4429,
    "parent": 4405,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4457,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4461,
    "parent": 4457,
    "notused": 36,
    "detail": "SCAN lix_internal_state_cache_v1_lix_version_tip"
  },
  {
    "id": 4469,
    "parent": 4457,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4481,
    "parent": 4457,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4509,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4513,
    "parent": 4509,
    "notused": 53,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set"
  },
  {
    "id": 4521,
    "parent": 4509,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4533,
    "parent": 4509,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4561,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4565,
    "parent": 4561,
    "notused": 72,
    "detail": "SCAN lix_internal_state_cache_v1_lix_change_set_element"
  },
  {
    "id": 4573,
    "parent": 4561,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4585,
    "parent": 4561,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4613,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4618,
    "parent": 4613,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_label USING INDEX idx_lix_internal_state_cache_v1_lix_label_live_vfe"
  },
  {
    "id": 4626,
    "parent": 4613,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4638,
    "parent": 4613,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4666,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4670,
    "parent": 4666,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_lix_key_value"
  },
  {
    "id": 4678,
    "parent": 4666,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4690,
    "parent": 4666,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4718,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4723,
    "parent": 4718,
    "notused": 62,
    "detail": "SCAN lix_internal_state_cache_v1_lix_active_account USING INDEX idx_lix_internal_state_cache_v1_lix_active_account_live_vfe"
  },
  {
    "id": 4731,
    "parent": 4718,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4743,
    "parent": 4718,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4771,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4775,
    "parent": 4771,
    "notused": 32,
    "detail": "SCAN lix_internal_state_cache_v1_test_bench_diff_entity"
  },
  {
    "id": 4783,
    "parent": 4771,
    "notused": 0,
    "detail": "BLOOM FILTER ON vi (version_id=?)"
  },
  {
    "id": 4795,
    "parent": 4771,
    "notused": 53,
    "detail": "SEARCH vi USING AUTOMATIC PARTIAL COVERING INDEX (version_id=?)"
  },
  {
    "id": 4823,
    "parent": 4186,
    "notused": 0,
    "detail": "UNION ALL"
  },
  {
    "id": 4828,
    "parent": 4823,
    "notused": 216,
    "detail": "SCAN vi"
  },
  {
    "id": 4832,
    "parent": 4823,
    "notused": 61,
    "detail": "SEARCH unt USING INDEX idx_lix_internal_state_all_untracked_version_id (version_id=?)"
  },
  {
    "id": 4865,
    "parent": 3854,
    "notused": 227,
    "detail": "SCAN c"
  },
  {
    "id": 4904,
    "parent": 3854,
    "notused": 0,
    "detail": "USE TEMP B-TREE FOR ORDER BY"
  },
  {
    "id": 4944,
    "parent": 3853,
    "notused": 207,
    "detail": "SCAN (subquery-143)"
  },
  {
    "id": 5029,
    "parent": 3825,
    "notused": 207,
    "detail": "SCAN w"
  },
  {
    "id": 5036,
    "parent": 3825,
    "notused": 45,
    "detail": "SEARCH ws_dst USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 5049,
    "parent": 3825,
    "notused": 45,
    "detail": "SEARCH ws_src USING PRIMARY KEY (file_id=? AND version_id=? AND entity_id=? AND schema_key=?) LEFT-JOIN"
  },
  {
    "id": 5088,
    "parent": 3824,
    "notused": 207,
    "detail": "SCAN w"
  },
  {
    "id": 5101,
    "parent": 3824,
    "notused": 0,
    "detail": "BLOOM FILTER ON lix_internal_state_vtable (version_id=? AND entity_id=? AND schema_key=? AND file_id=?)"
  },
  {
    "id": 5127,
    "parent": 3824,
    "notused": 52,
    "detail": "SEARCH lix_internal_state_vtable USING AUTOMATIC PARTIAL COVERING INDEX (version_id=? AND entity_id=? AND schema_key=? AND file_id=?) LEFT-JOIN"
  }
]